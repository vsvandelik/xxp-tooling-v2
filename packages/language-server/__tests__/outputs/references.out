Debugger listening on ws://127.0.0.1:53327/79dc9e80-c221-4822-a7ff-fc6e80614016
For help, see: https://nodejs.org/en/docs/inspector
Debugger attached.
  console.log
    Debug - Marker processing:

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:773:13)
          at Array.forEach (<anonymous>)

  console.log
      Marked content: "space2"

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:774:13)
          at Array.forEach (<anonymous>)

  console.log
      Base character: 10

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:775:13)
          at Array.forEach (<anonymous>)

  console.log
      Final position: line 9, character 13

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:776:13)
          at Array.forEach (<anonymous>)

  console.log
    Debug - Marker processing:

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:773:13)
          at Array.forEach (<anonymous>)

  console.log
      Marked content: "extendedTask"

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:774:13)
          at Array.forEach (<anonymous>)

  console.log
      Base character: 16

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:775:13)
          at Array.forEach (<anonymous>)

  console.log
      Final position: line 2, character 22

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:776:13)
          at Array.forEach (<anonymous>)

  console.log
    Debug - Marker processing:

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:773:13)
          at Array.forEach (<anonymous>)

  console.log
      Marked content: "nonExistentTask"

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:774:13)
          at Array.forEach (<anonymous>)

  console.log
      Base character: 19

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:775:13)
          at Array.forEach (<anonymous>)

  console.log
      Final position: line 1, character 26

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:776:13)
          at Array.forEach (<anonymous>)

  console.log
    Debug - Marker processing:

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:773:13)
          at Array.forEach (<anonymous>)

  console.log
      Marked content: "unusedTask"

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:774:13)
          at Array.forEach (<anonymous>)

  console.log
      Base character: 16

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:775:13)
          at Array.forEach (<anonymous>)

  console.log
      Final position: line 1, character 21

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:776:13)
          at Array.forEach (<anonymous>)

  console.log
    Debug - Marker processing:

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:773:13)
          at Array.forEach (<anonymous>)

  console.log
      Marked content: "s1"

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:774:13)
          at Array.forEach (<anonymous>)

  console.log
      Base character: 17

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:775:13)
          at Array.forEach (<anonymous>)

  console.log
      Final position: line 10, character 18

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:776:13)
          at Array.forEach (<anonymous>)

  console.log
    Debug - Marker processing:

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:773:13)
          at Array.forEach (<anonymous>)

  console.log
      Marked content: "experimentData"

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:774:13)
          at Array.forEach (<anonymous>)

  console.log
      Base character: 16

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:775:13)
          at Array.forEach (<anonymous>)

  console.log
      Final position: line 1, character 23

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:776:13)
          at Array.forEach (<anonymous>)

  console.log
    Debug - Marker processing:

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:773:13)
          at Array.forEach (<anonymous>)

  console.log
      Marked content: "MyExperiment"

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:774:13)
          at Array.forEach (<anonymous>)

  console.log
      Base character: 11

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:775:13)
          at Array.forEach (<anonymous>)

  console.log
      Final position: line 0, character 17

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:776:13)
          at Array.forEach (<anonymous>)

  console.log
    Debug - Marker processing:

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:773:13)
          at Array.forEach (<anonymous>)

  console.log
      Marked content: "learningRate"

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:774:13)
          at Array.forEach (<anonymous>)

  console.log
      Base character: 14

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:775:13)
          at Array.forEach (<anonymous>)

  console.log
      Final position: line 3, character 20

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:776:13)
          at Array.forEach (<anonymous>)

  console.log
    Debug - Marker processing:

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:773:13)
          at Array.forEach (<anonymous>)

  console.log
      Marked content: "s1"

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:774:13)
          at Array.forEach (<anonymous>)

  console.log
      Base character: 10

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:775:13)
          at Array.forEach (<anonymous>)

  console.log
      Final position: line 1, character 11

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:776:13)
          at Array.forEach (<anonymous>)

  console.log
    Debug - Marker processing:

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:773:13)
          at Array.forEach (<anonymous>)

  console.log
      Marked content: "s1"

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:774:13)
          at Array.forEach (<anonymous>)

  console.log
      Base character: 17

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:775:13)
          at Array.forEach (<anonymous>)

  console.log
      Final position: line 6, character 18

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:776:13)
          at Array.forEach (<anonymous>)

  console.log
    Debug - Marker processing:

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:773:13)
          at Array.forEach (<anonymous>)

  console.log
      Marked content: "myTask"

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:774:13)
          at Array.forEach (<anonymous>)

  console.log
      Base character: 23

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:775:13)
          at Array.forEach (<anonymous>)

  console.log
      Final position: line 4, character 26

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:776:13)
          at Array.forEach (<anonymous>)

  console.log
    Debug - Marker processing:

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:773:13)
          at Array.forEach (<anonymous>)

  console.log
      Marked content: "SimpleWorkflow"

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:774:13)
          at Array.forEach (<anonymous>)

  console.log
      Base character: 16

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:775:13)
          at Array.forEach (<anonymous>)

  console.log
      Final position: line 1, character 23

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:776:13)
          at Array.forEach (<anonymous>)

  console.log
    Debug - Marker processing:

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:773:13)
          at Array.forEach (<anonymous>)

  console.log
      Marked content: "BaseML"

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:774:13)
          at Array.forEach (<anonymous>)

  console.log
      Base character: 25

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:775:13)
          at Array.forEach (<anonymous>)

  console.log
      Final position: line 0, character 28

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:776:13)
          at Array.forEach (<anonymous>)

  console.log
    Debug - Marker processing:

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:773:13)
          at Array.forEach (<anonymous>)

  console.log
      Marked content: "train"

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:774:13)
          at Array.forEach (<anonymous>)

  console.log
      Base character: 23

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:775:13)
          at Array.forEach (<anonymous>)

  console.log
      Final position: line 4, character 25

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:776:13)
          at Array.forEach (<anonymous>)

  console.log
    Debug - Marker processing:

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:773:13)
          at Array.forEach (<anonymous>)

  console.log
      Marked content: "DataProcessing"

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:774:13)
          at Array.forEach (<anonymous>)

  console.log
      Base character: 27

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:775:13)
          at Array.forEach (<anonymous>)

  console.log
      Final position: line 1, character 34

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:776:13)
          at Array.forEach (<anonymous>)

  console.log
    Debug - Marker processing:

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:773:13)
          at Array.forEach (<anonymous>)

  console.log
      Marked content: "taskA"

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:774:13)
          at Array.forEach (<anonymous>)

  console.log
      Base character: 13

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:775:13)
          at Array.forEach (<anonymous>)

  console.log
      Final position: line 10, character 15

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:776:13)
          at Array.forEach (<anonymous>)

  console.log
    Debug - Marker processing:

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:773:13)
          at Array.forEach (<anonymous>)

  console.log
      Marked content: "inputData"

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:774:13)
          at Array.forEach (<anonymous>)

  console.log
      Base character: 16

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:775:13)
          at Array.forEach (<anonymous>)

  console.log
      Final position: line 1, character 20

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:776:13)
          at Array.forEach (<anonymous>)

  console.log
    Debug - Marker processing:

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:773:13)
          at Array.forEach (<anonymous>)

  console.log
      Marked content: "inputData"

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:774:13)
          at Array.forEach (<anonymous>)

  console.log
      Base character: 14

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:775:13)
          at Array.forEach (<anonymous>)

  console.log
      Final position: line 5, character 18

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:776:13)
          at Array.forEach (<anonymous>)

  console.log
    Debug - Marker processing:

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:773:13)
          at Array.forEach (<anonymous>)

  console.log
      Marked content: "myTask"

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:774:13)
          at Array.forEach (<anonymous>)

  console.log
      Base character: 19

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:775:13)
          at Array.forEach (<anonymous>)

  console.log
      Final position: line 4, character 22

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:776:13)
          at Array.forEach (<anonymous>)

  console.log
    Debug - Marker processing:

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:773:13)
          at Array.forEach (<anonymous>)

  console.log
      Marked content: "myTask"

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:774:13)
          at Array.forEach (<anonymous>)

  console.log
      Base character: 16

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:775:13)
          at Array.forEach (<anonymous>)

  console.log
      Final position: line 1, character 19

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:776:13)
          at Array.forEach (<anonymous>)

  console.log
    Debug - Marker processing:

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:773:13)
          at Array.forEach (<anonymous>)

  console.log
      Marked content: "myTask"

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:774:13)
          at Array.forEach (<anonymous>)

  console.log
      Base character: 13

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:775:13)
          at Array.forEach (<anonymous>)

  console.log
      Final position: line 6, character 16

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:776:13)
          at Array.forEach (<anonymous>)

  console.log
    Debug - Marker processing:

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:773:13)
          at Array.forEach (<anonymous>)

  console.log
      Marked content: "MyWorkflow"

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:774:13)
          at Array.forEach (<anonymous>)

  console.log
      Base character: 9

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:775:13)
          at Array.forEach (<anonymous>)

  console.log
      Final position: line 0, character 14

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:776:13)
          at Array.forEach (<anonymous>)

  console.log
    Debug - Marker processing:

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:773:13)
          at Array.forEach (<anonymous>)

  console.log
      Marked content: "BaseWorkflow"

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:774:13)
          at Array.forEach (<anonymous>)

  console.log
      Base character: 30

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:775:13)
          at Array.forEach (<anonymous>)

  console.log
      Final position: line 0, character 36

      at processFileWithMarker (__tests__/ReferencesIntegration.test.ts:776:13)
          at Array.forEach (<anonymous>)

  console.log
    Starting language server: /root/xxp-tooling-v2/packages/language-server/dist/server.js

      at Object.<anonymous> (__tests__/ReferencesIntegration.test.ts:362:13)

  console.log
    🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":4,"message":"[REFS] Adding handlers for ReferencesProvider"}}

      at Socket.<anonymous> (__tests__/ReferencesIntegration.test.ts:77:19)

  console.log
    🔍 REFS STDOUT: Content-Length: 124
    
    {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Adding handlers for ReferencesProvider"}}Content-Length: 113
    
    {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":4,"message":"[REFS] Handlers added successfully"}}Content-Length: 113
    
    {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handlers added successfully"}}Content-Length: 152
    
    {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":3,"message":"[2025-06-25T12:44:48.365Z] [INFO] Registered provider: ReferencesProvider"}}Content-Length: 149
    
    {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":3,"message":"[2025-06-25T12:44:48.368Z] [INFO] Registered provider: RenamerProvider"}}Content-Length: 153
    
    {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":3,"message":"[2025-06-25T12:44:48.369Z] [INFO] Registered provider: SuggestionsProvider"}}

      at Socket.<anonymous> (__tests__/ReferencesIntegration.test.ts:77:19)


=== Running definition/references test: complex-multi-space ===
Test temp directory: /tmp/lsp-def-ref-tests-JDqHso/complex-multi-space-bNoJzm
Created file: CommonWorkflow.xxp at /tmp/lsp-def-ref-tests-JDqHso/complex-multi-space-bNoJzm/CommonWorkflow.xxp
Created file: experiment.espace at /tmp/lsp-def-ref-tests-JDqHso/complex-multi-space-bNoJzm/experiment.espace
Opening document: CommonWorkflow.xxp -> file:////tmp/lsp-def-ref-tests-JDqHso/complex-multi-space-bNoJzm/CommonWorkflow.xxp
Document content (first 200 chars):
workflow CommonWorkflow {
    define task process;
    
    configure task process {}

    START -> process -> END;
}
Opening document: experiment.espace -> file:////tmp/lsp-def-ref-tests-JDqHso/complex-multi-space-bNoJzm/experiment.espace
Document content (first 200 chars):
experiment MultiSpaceExperiment {
    space space1 of CommonWorkflow {
        strategy randomSearch;
        
        configure task process {
            param param1 = enum(1, 2, 3);
        }
    ...
Waiting for document processing...
Testing on: experiment.espace at position {"line":9,"character":13}
Context around request position: "e space2 of Com"
Line 9: "    space space2 of CommonWorkflow {"
Character 13: "c"
File content with line numbers and character positions:
  0: "experiment MultiSpaceExperiment {"
     012345678901234567890123456789012
  1: "    space space1 of CommonWorkflow {"
     012345678901234567890123456789012345
  2: "        strategy randomSearch;"
     012345678901234567890123456789
  3: "        "
  4: "        configure task process {"
  5: "            param param1 = enum(1, 2, 3);"
  6: "        }"
  7: "    }"
  8: "    "
  9: "    space space2 of CommonWorkflow {"
  10: "        strategy gridSearch;"
  11: "        "
  12: "        configure task process {"
  13: "            param param2 = range(0.1, 1.0, 0.1);"
  14: "        }"
  15: "    }"
  16: "    "
  17: "    control {"
  18: "        start -> space1 -?> space2 {"
  19: "            condition "metric > threshold";"
  20: "        }"
  21: "        space1 -> end;"
  22: "        space2 -> end;"
  23: "    }"
  24: "}"
Requesting definition for file:////tmp/lsp-def-ref-tests-JDqHso/complex-multi-space-bNoJzm/experiment.espace at {"line":9,"character":13}
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":4,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/complex-multi-space-bNoJzm/experiment.espace at {\"line\":9,\"character\":13}"}}Content-Length: 221

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/complex-multi-space-bNoJzm/experiment.espace at {\"line\":9,\"character\":13}"}}Content-Length: 148

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] TokenPosition: text=\"space2\", context=\"SpaceHeaderContext\""}}
🔍 REFS STDOUT: Content-Length: 145

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"space2\" in context \"SpaceHeaderContext\""}}Content-Length: 154

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=false"}}Content-Length: 113

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling SpaceHeaderContext"}}Content-Length: 132

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Trying experimentSymbol for SpaceHeaderContext"}}Content-Length: 119

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found in experimentSymbol: space2"}}Content-Length: 137

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found symbol: name=\"space2\", type=\"SpaceSymbol\""}}Content-Length: 153
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: symbol=\"space2\", type=\"SpaceSymbol\""}}Content-Length: 154

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: parseTree context=\"SpaceHeaderContext\""}}Content-Length: 169

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: contextName=\"SpaceHeaderContext\", symbolName=\"space2\""}}Content-Length: 144

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: position=1, symbolName=\"space2\""}}Content-Length: 138

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: parseTree.getChildCount()=4"}}Content-Length: 177

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: child at 1: text=\"space2\", isTerminalNode=true, textMatches=true"}}Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: Found matching terminal node"}}Content-Length: 151

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: identifierNode found, text=\"space2\""}}Content-Length: 211
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: RangeUtils result={\"start\":{\"line\":9,\"character\":10},\"end\":{\"line\":9,\"character\":16}}"}}Content-Length: 313

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: Final result={\"uri\":\"file:////tmp/lsp-def-ref-tests-JDqHso/complex-multi-space-bNoJzm/experiment.espace\",\"range\":{\"start\":{\"line\":9,\"character\":10},\"end\":{\"line\":9,\"character\":16}}}"}}Content-Length: 185

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Generated location: {\"start\":{\"line\":9,\"character\":10},\"end\":{\"line\":9,\"character\":16}}"}}Content-Length: 202

{"jsonrpc":"2.0","id":2,"result":{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/complex-multi-space-bNoJzm/experiment.espace","range":{"start":{"line":9,"character":10},"end":{"line":9,"character":16}}}}
Definition response: {
  uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/complex-multi-space-bNoJzm/experiment.espace',
  range: {
    start: { line: 9, character: 10 },
    end: { line: 9, character: 16 }
  }
}
Definition result: {
  "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/complex-multi-space-bNoJzm/experiment.espace",
  "range": {
    "start": {
      "line": 9,
      "character": 10
    },
    "end": {
      "line": 9,
      "character": 16
    }
  }
}
Requesting references for file:////tmp/lsp-def-ref-tests-JDqHso/complex-multi-space-bNoJzm/experiment.espace at {"line":9,"character":13}
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":3,"message":"[2025-06-25T12:44:49.180Z] [INFO] Received references request for document: file:////tmp/lsp-def-ref-tests-JDqHso/complex-multi-space-bNoJzm/experiment.espace"}}Content-Length: 145

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"space2\" in context \"SpaceHeaderContext\""}}Content-Length: 154
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=false"}}Content-Length: 113

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling SpaceHeaderContext"}}Content-Length: 132

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Trying experimentSymbol for SpaceHeaderContext"}}Content-Length: 119

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found in experimentSymbol: space2"}}Content-Length: 153

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: symbol=\"space2\", type=\"SpaceSymbol\""}}Content-Length: 154

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: parseTree context=\"SpaceHeaderContext\""}}Content-Length: 169

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: contextName=\"SpaceHeaderContext\", symbolName=\"space2\""}}Content-Length: 144

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: position=1, symbolName=\"space2\""}}Content-Length: 138

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: parseTree.getChildCount()=4"}}
🔍 REFS STDOUT: Content-Length: 177

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: child at 1: text=\"space2\", isTerminalNode=true, textMatches=true"}}Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: Found matching terminal node"}}Content-Length: 151

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: identifierNode found, text=\"space2\""}}Content-Length: 211

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: RangeUtils result={\"start\":{\"line\":9,\"character\":10},\"end\":{\"line\":9,\"character\":16}}"}}Content-Length: 313

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: Final result={\"uri\":\"file:////tmp/lsp-def-ref-tests-JDqHso/complex-multi-space-bNoJzm/experiment.espace\",\"range\":{\"start\":{\"line\":9,\"character\":10},\"end\":{\"line\":9,\"character\":16}}}"}}Content-Length: 204

{"jsonrpc":"2.0","id":3,"result":[{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/complex-multi-space-bNoJzm/experiment.espace","range":{"start":{"line":9,"character":10},"end":{"line":9,"character":16}}}]}
References response: [
  {
    uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/complex-multi-space-bNoJzm/experiment.espace',
    range: { start: [Object], end: [Object] }
  }
]
References result: [
  {
    "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/complex-multi-space-bNoJzm/experiment.espace",
    "range": {
      "start": {
        "line": 9,
        "character": 10
      },
      "end": {
        "line": 9,
        "character": 16
      }
    }
  }
]
Expected definition: experiment.espace:19:11-17
Actual definition ranges:
  [0] 10:11-17 in file:////tmp/lsp-def-ref-tests-jdqhso/complex-multi-space-bnojzm/experiment.espace
❌ No matching definition found!
Expected: experiment.espace:19:11-17 (URI: file:////tmp/lsp-def-ref-tests-jdqhso/complex-multi-space-bnojzm/experiment.espace)
Available definitions:
  [0] 10:11-17 in file:////tmp/lsp-def-ref-tests-jdqhso/complex-multi-space-bnojzm/experiment.espace
📊 Test complex-multi-space failed: Error: Definition test failed - no matching definition found. Expected: experiment.espace:19:11-17 (URI: file:////tmp/lsp-def-ref-tests-jdqhso/complex-multi-space-bnojzm/experiment.espace)
Cleaned up test directory: /tmp/lsp-def-ref-tests-JDqHso/complex-multi-space-bNoJzm

=== Running definition/references test: comprehensive-full-features ===
Test temp directory: /tmp/lsp-def-ref-tests-JDqHso/comprehensive-full-features-qmTVM7
Created file: BaseWorkflow.xxp at /tmp/lsp-def-ref-tests-JDqHso/comprehensive-full-features-qmTVM7/BaseWorkflow.xxp
Created file: ExtendedWorkflow.xxp at /tmp/lsp-def-ref-tests-JDqHso/comprehensive-full-features-qmTVM7/ExtendedWorkflow.xxp
Created file: MLExperiment.espace at /tmp/lsp-def-ref-tests-JDqHso/comprehensive-full-features-qmTVM7/MLExperiment.espace
Opening document: BaseWorkflow.xxp -> file:////tmp/lsp-def-ref-tests-JDqHso/comprehensive-full-features-qmTVM7/BaseWorkflow.xxp
Document content (first 200 chars):
workflow BaseWorkflow {
    define data baseData = "base.csv";
    define task baseTask;
    
    configure task baseTask {
        input baseData;
    }

    START -> baseTask -> END;
}
Opening document: ExtendedWorkflow.xxp -> file:////tmp/lsp-def-ref-tests-JDqHso/comprehensive-full-features-qmTVM7/ExtendedWorkflow.xxp
Document content (first 200 chars):
workflow ExtendedWorkflow from BaseWorkflow {
    define data extendedData = "extended.csv";
    define task extendedTask;
    
    configure task extendedTask {
        input extendedData;
        ou...
Opening document: MLExperiment.espace -> file:////tmp/lsp-def-ref-tests-JDqHso/comprehensive-full-features-qmTVM7/MLExperiment.espace
Document content (first 200 chars):
experiment MLExperiment {
    define data experimentData = "experiment.csv";
    
    space baseSpace of BaseWorkflow {
        strategy randomSearch;
        param iterations = range(10, 100, 10);
  ...
Waiting for document processing...
Testing on: ExtendedWorkflow.xxp at position {"line":2,"character":22}
Context around request position: "xtendedTask;"
Line 2: "    define task extendedTask;"
Character 22: "e"
File content with line numbers and character positions:
  0: "workflow ExtendedWorkflow from BaseWorkflow {"
     012345678901234567890123456789012345678901234
  1: "    define data extendedData = "extended.csv";"
     0123456789012345678901234567890123456789012345
  2: "    define task extendedTask;"
     01234567890123456789012345678
  3: "    "
  4: "    configure task extendedTask {"
  5: "        input extendedData;"
  6: "        output baseData;"
  7: "    }"
  8: ""
  9: "    START -> baseTask -> extendedTask -> END;"
  10: "}"
Requesting definition for file:////tmp/lsp-def-ref-tests-JDqHso/comprehensive-full-features-qmTVM7/ExtendedWorkflow.xxp at {"line":2,"character":22}
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":4,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/comprehensive-full-features-qmTVM7/ExtendedWorkflow.xxp at {\"line\":2,\"character\":22}"}}
🔍 REFS STDOUT: Content-Length: 232

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/comprehensive-full-features-qmTVM7/ExtendedWorkflow.xxp at {\"line\":2,\"character\":22}"}}Content-Length: 157

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] TokenPosition: text=\"extendedTask\", context=\"TaskDefinitionContext\""}}Content-Length: 154

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"extendedTask\" in context \"TaskDefinitionContext\""}}
🔍 REFS STDOUT: Content-Length: 153

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=true"}}Content-Length: 116

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling TaskDefinitionContext"}}
🔍 REFS STDOUT: Content-Length: 147

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Trying document.workflowSymbolTable for TaskDefinitionContext"}}Content-Length: 128

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found in workflowSymbolTable: extendedTask"}}Content-Length: 142

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found symbol: name=\"extendedTask\", type=\"TaskSymbol\""}}Content-Length: 158

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: symbol=\"extendedTask\", type=\"TaskSymbol\""}}Content-Length: 157

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: parseTree context=\"TaskDefinitionContext\""}}Content-Length: 178
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: contextName=\"TaskDefinitionContext\", symbolName=\"extendedTask\""}}Content-Length: 150

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: position=2, symbolName=\"extendedTask\""}}Content-Length: 138

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: parseTree.getChildCount()=4"}}Content-Length: 183

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: child at 2: text=\"extendedTask\", isTerminalNode=true, textMatches=true"}}Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: Found matching terminal node"}}
🔍 REFS STDOUT: Content-Length: 157

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: identifierNode found, text=\"extendedTask\""}}Content-Length: 211

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: RangeUtils result={\"start\":{\"line\":2,\"character\":16},\"end\":{\"line\":2,\"character\":28}}"}}Content-Length: 324

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: Final result={\"uri\":\"file:////tmp/lsp-def-ref-tests-JDqHso/comprehensive-full-features-qmTVM7/ExtendedWorkflow.xxp\",\"range\":{\"start\":{\"line\":2,\"character\":16},\"end\":{\"line\":2,\"character\":28}}}"}}Content-Length: 185

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Generated location: {\"start\":{\"line\":2,\"character\":16},\"end\":{\"line\":2,\"character\":28}}"}}
Definition response: {
  uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/comprehensive-full-features-qmTVM7/ExtendedWorkflow.xxp',
  range: {
    start: { line: 2, character: 16 },
    end: { line: 2, character: 28 }
  }
}
Definition result: {
  "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/comprehensive-full-features-qmTVM7/ExtendedWorkflow.xxp",
  "range": {
    "start": {
      "line": 2,
      "character": 16
    },
    "end": {
      "line": 2,
      "character": 28
    }
  }
}
Requesting references for file:////tmp/lsp-def-ref-tests-JDqHso/comprehensive-full-features-qmTVM7/ExtendedWorkflow.xxp at {"line":2,"character":22}
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"extendedTask\" in context \"TaskDefinitionContext\""}}Content-Length: 153
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=true"}}Content-Length: 116

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling TaskDefinitionContext"}}Content-Length: 147

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Trying document.workflowSymbolTable for TaskDefinitionContext"}}Content-Length: 128

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found in workflowSymbolTable: extendedTask"}}Content-Length: 158
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: symbol=\"extendedTask\", type=\"TaskSymbol\""}}Content-Length: 157

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: parseTree context=\"TaskDefinitionContext\""}}Content-Length: 178

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: contextName=\"TaskDefinitionContext\", symbolName=\"extendedTask\""}}Content-Length: 150

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: position=2, symbolName=\"extendedTask\""}}Content-Length: 138

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: parseTree.getChildCount()=4"}}Content-Length: 183

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: child at 2: text=\"extendedTask\", isTerminalNode=true, textMatches=true"}}Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: Found matching terminal node"}}Content-Length: 157
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: identifierNode found, text=\"extendedTask\""}}Content-Length: 211

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: RangeUtils result={\"start\":{\"line\":2,\"character\":16},\"end\":{\"line\":2,\"character\":28}}"}}Content-Length: 324

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: Final result={\"uri\":\"file:////tmp/lsp-def-ref-tests-JDqHso/comprehensive-full-features-qmTVM7/ExtendedWorkflow.xxp\",\"range\":{\"start\":{\"line\":2,\"character\":16},\"end\":{\"line\":2,\"character\":28}}}"}}Content-Length: 575

{"jsonrpc":"2.0","id":5,"result":[{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/comprehensive-full-features-qmTVM7/ExtendedWorkflow.xxp","range":{"start":{"line":4,"character":19},"end":{"line":4,"character":31}}},{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/comprehensive-full-features-qmTVM7/ExtendedWorkflow.xxp","range":{"start":{"line":9,"character":25},"end":{"line":9,"character":37}}},{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/comprehensive-full-features-qmTVM7/ExtendedWorkflow.xxp","range":{"start":{"line":2,"character":16},"end":{"line":2,"character":28}}}]}
References response: [
  {
    uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/comprehensive-full-features-qmTVM7/ExtendedWorkflow.xxp',
    range: { start: [Object], end: [Object] }
  },
  {
    uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/comprehensive-full-features-qmTVM7/ExtendedWorkflow.xxp',
    range: { start: [Object], end: [Object] }
  },
  {
    uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/comprehensive-full-features-qmTVM7/ExtendedWorkflow.xxp',
    range: { start: [Object], end: [Object] }
  }
]
References result: [
  {
    "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/comprehensive-full-features-qmTVM7/ExtendedWorkflow.xxp",
    "range": {
      "start": {
        "line": 4,
        "character": 19
      },
      "end": {
        "line": 4,
        "character": 31
      }
    }
  },
  {
    "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/comprehensive-full-features-qmTVM7/ExtendedWorkflow.xxp",
    "range": {
      "start": {
        "line": 9,
        "character": 25
      },
      "end": {
        "line": 9,
        "character": 37
      }
    }
  },
  {
    "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/comprehensive-full-features-qmTVM7/ExtendedWorkflow.xxp",
    "range": {
      "start": {
        "line": 2,
        "character": 16
      },
      "end": {
        "line": 2,
        "character": 28
      }
    }
  }
]
Expected definition: ExtendedWorkflow.xxp:3:17-30
Actual definition ranges:
  [0] 3:17-29 in file:////tmp/lsp-def-ref-tests-jdqhso/comprehensive-full-features-qmtvm7/extendedworkflow.xxp
❌ No matching definition found!
Expected: ExtendedWorkflow.xxp:3:17-30 (URI: file:////tmp/lsp-def-ref-tests-jdqhso/comprehensive-full-features-qmtvm7/extendedworkflow.xxp)
Available definitions:
  [0] 3:17-29 in file:////tmp/lsp-def-ref-tests-jdqhso/comprehensive-full-features-qmtvm7/extendedworkflow.xxp
📊 Test comprehensive-full-features failed: Error: Definition test failed - no matching definition found. Expected: ExtendedWorkflow.xxp:3:17-30 (URI: file:////tmp/lsp-def-ref-tests-jdqhso/comprehensive-full-features-qmtvm7/extendedworkflow.xxp)
Cleaned up test directory: /tmp/lsp-def-ref-tests-JDqHso/comprehensive-full-features-qmTVM7

=== Running definition/references test: edge-case-no-definition ===
Test temp directory: /tmp/lsp-def-ref-tests-JDqHso/edge-case-no-definition-ukGICg
Created file: workflow.xxp at /tmp/lsp-def-ref-tests-JDqHso/edge-case-no-definition-ukGICg/workflow.xxp
Opening document: workflow.xxp -> file:////tmp/lsp-def-ref-tests-JDqHso/edge-case-no-definition-ukGICg/workflow.xxp
Document content (first 200 chars):
workflow SimpleWorkflow {
    configure task nonExistentTask {}

    START -> END;
}
Waiting for document processing...
Testing on: workflow.xxp at position {"line":1,"character":26}
Context around request position: "nExistentTask {"
Line 1: "    configure task nonExistentTask {}"
Character 26: "t"
File content with line numbers and character positions:
  0: "workflow SimpleWorkflow {"
     0123456789012345678901234
  1: "    configure task nonExistentTask {}"
     0123456789012345678901234567890123456
  2: ""
     
  3: "    START -> END;"
  4: "}"
Requesting definition for file:////tmp/lsp-def-ref-tests-JDqHso/edge-case-no-definition-ukGICg/workflow.xxp at {"line":1,"character":26}
🔍 REFS STDOUT: Content-Length: 220

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":4,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/edge-case-no-definition-ukGICg/workflow.xxp at {\"line\":1,\"character\":26}"}}
🔍 REFS STDOUT: Content-Length: 220

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/edge-case-no-definition-ukGICg/workflow.xxp at {\"line\":1,\"character\":26}"}}Content-Length: 158

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] TokenPosition: text=\"nonExistentTask\", context=\"TaskNameReadContext\""}}Content-Length: 155

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"nonExistentTask\" in context \"TaskNameReadContext\""}}Content-Length: 153

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=true"}}Content-Length: 114

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling TaskNameReadContext"}}Content-Length: 136

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] TaskNameReadContext: No experimentSymbol available"}}
🔍 REFS STDOUT: Content-Length: 143

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Using default resolution for context: TaskNameReadContext"}}Content-Length: 130

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default: Trying document.workflowSymbolTable"}}Content-Length: 122

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default: Trying document.symbolTable"}}Content-Length: 119

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default: Trying folderSymbolTable"}}Content-Length: 141

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default resolution failed: No symbol found in any table"}}
🔍 REFS STDOUT: Content-Length: 125

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] No symbol found for \"nonExistentTask\""}}Content-Length: 38

{"jsonrpc":"2.0","id":6,"result":null}
Definition response: null
Definition result: null
Requesting references for file:////tmp/lsp-def-ref-tests-JDqHso/edge-case-no-definition-ukGICg/workflow.xxp at {"line":1,"character":26}
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":3,"message":"[2025-06-25T12:44:50.807Z] [INFO] Received references request for document: file:////tmp/lsp-def-ref-tests-JDqHso/edge-case-no-definition-ukGICg/workflow.xxp"}}Content-Length: 155

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"nonExistentTask\" in context \"TaskNameReadContext\""}}Content-Length: 153

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=true"}}Content-Length: 114

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling TaskNameReadContext"}}Content-Length: 136
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] TaskNameReadContext: No experimentSymbol available"}}Content-Length: 143

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Using default resolution for context: TaskNameReadContext"}}Content-Length: 130

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default: Trying document.workflowSymbolTable"}}Content-Length: 122

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default: Trying document.symbolTable"}}Content-Length: 119

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default: Trying folderSymbolTable"}}Content-Length: 141

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default resolution failed: No symbol found in any table"}}Content-Length: 38

{"jsonrpc":"2.0","id":7,"result":null}
References response: null
References result: null
✅ Definition test passed (no definition expected)
✅ References test passed (no references expected)
📊 Test edge-case-no-definition completed (debug mode)
Cleaned up test directory: /tmp/lsp-def-ref-tests-JDqHso/edge-case-no-definition-ukGICg

=== Running definition/references test: edge-case-no-references ===
Test temp directory: /tmp/lsp-def-ref-tests-JDqHso/edge-case-no-references-3zIKjg
Created file: workflow.xxp at /tmp/lsp-def-ref-tests-JDqHso/edge-case-no-references-3zIKjg/workflow.xxp
Opening document: workflow.xxp -> file:////tmp/lsp-def-ref-tests-JDqHso/edge-case-no-references-3zIKjg/workflow.xxp
Document content (first 200 chars):
workflow SimpleWorkflow {
    define task unusedTask;
    define task usedTask;
    
    configure task usedTask {}

    START -> usedTask -> END;
}
Waiting for document processing...
Testing on: workflow.xxp at position {"line":1,"character":21}
Context around request position: "unusedTask;"
Line 1: "    define task unusedTask;"
Character 21: "d"
File content with line numbers and character positions:
  0: "workflow SimpleWorkflow {"
     0123456789012345678901234
  1: "    define task unusedTask;"
     012345678901234567890123456
  2: "    define task usedTask;"
     0123456789012345678901234
  3: "    "
  4: "    configure task usedTask {}"
  5: ""
  6: "    START -> usedTask -> END;"
  7: "}"
Requesting definition for file:////tmp/lsp-def-ref-tests-JDqHso/edge-case-no-references-3zIKjg/workflow.xxp at {"line":1,"character":21}
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":4,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/edge-case-no-references-3zIKjg/workflow.xxp at {\"line\":1,\"character\":21}"}}Content-Length: 220
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/edge-case-no-references-3zIKjg/workflow.xxp at {\"line\":1,\"character\":21}"}}Content-Length: 155

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] TokenPosition: text=\"unusedTask\", context=\"TaskDefinitionContext\""}}Content-Length: 152

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"unusedTask\" in context \"TaskDefinitionContext\""}}Content-Length: 153

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=true"}}Content-Length: 116

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling TaskDefinitionContext"}}Content-Length: 147
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Trying document.workflowSymbolTable for TaskDefinitionContext"}}Content-Length: 126

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found in workflowSymbolTable: unusedTask"}}Content-Length: 140

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found symbol: name=\"unusedTask\", type=\"TaskSymbol\""}}Content-Length: 156

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: symbol=\"unusedTask\", type=\"TaskSymbol\""}}Content-Length: 157

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: parseTree context=\"TaskDefinitionContext\""}}
🔍 REFS STDOUT: Content-Length: 176

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: contextName=\"TaskDefinitionContext\", symbolName=\"unusedTask\""}}Content-Length: 148

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: position=2, symbolName=\"unusedTask\""}}Content-Length: 138

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: parseTree.getChildCount()=4"}}Content-Length: 181

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: child at 2: text=\"unusedTask\", isTerminalNode=true, textMatches=true"}}Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: Found matching terminal node"}}
🔍 REFS STDOUT: Content-Length: 155

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: identifierNode found, text=\"unusedTask\""}}Content-Length: 211

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: RangeUtils result={\"start\":{\"line\":1,\"character\":16},\"end\":{\"line\":1,\"character\":26}}"}}Content-Length: 312

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: Final result={\"uri\":\"file:////tmp/lsp-def-ref-tests-JDqHso/edge-case-no-references-3zIKjg/workflow.xxp\",\"range\":{\"start\":{\"line\":1,\"character\":16},\"end\":{\"line\":1,\"character\":26}}}"}}Content-Length: 185

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Generated location: {\"start\":{\"line\":1,\"character\":16},\"end\":{\"line\":1,\"character\":26}}"}}Content-Length: 201

{"jsonrpc":"2.0","id":8,"result":{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/edge-case-no-references-3zIKjg/workflow.xxp","range":{"start":{"line":1,"character":16},"end":{"line":1,"character":26}}}}
Definition response: {
  uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/edge-case-no-references-3zIKjg/workflow.xxp',
  range: {
    start: { line: 1, character: 16 },
    end: { line: 1, character: 26 }
  }
}
Definition result: {
  "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/edge-case-no-references-3zIKjg/workflow.xxp",
  "range": {
    "start": {
      "line": 1,
      "character": 16
    },
    "end": {
      "line": 1,
      "character": 26
    }
  }
}
Requesting references for file:////tmp/lsp-def-ref-tests-JDqHso/edge-case-no-references-3zIKjg/workflow.xxp at {"line":1,"character":21}
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"unusedTask\" in context \"TaskDefinitionContext\""}}
🔍 REFS STDOUT: Content-Length: 153

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=true"}}Content-Length: 116

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling TaskDefinitionContext"}}Content-Length: 147

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Trying document.workflowSymbolTable for TaskDefinitionContext"}}Content-Length: 126
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found in workflowSymbolTable: unusedTask"}}Content-Length: 156

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: symbol=\"unusedTask\", type=\"TaskSymbol\""}}Content-Length: 157

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: parseTree context=\"TaskDefinitionContext\""}}Content-Length: 176

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: contextName=\"TaskDefinitionContext\", symbolName=\"unusedTask\""}}
🔍 REFS STDOUT: Content-Length: 148

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: position=2, symbolName=\"unusedTask\""}}Content-Length: 138

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: parseTree.getChildCount()=4"}}Content-Length: 181

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: child at 2: text=\"unusedTask\", isTerminalNode=true, textMatches=true"}}Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: Found matching terminal node"}}Content-Length: 155
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: identifierNode found, text=\"unusedTask\""}}Content-Length: 211

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: RangeUtils result={\"start\":{\"line\":1,\"character\":16},\"end\":{\"line\":1,\"character\":26}}"}}Content-Length: 312

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: Final result={\"uri\":\"file:////tmp/lsp-def-ref-tests-JDqHso/edge-case-no-references-3zIKjg/workflow.xxp\",\"range\":{\"start\":{\"line\":1,\"character\":16},\"end\":{\"line\":1,\"character\":26}}}"}}
References response: [
  {
    uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/edge-case-no-references-3zIKjg/workflow.xxp',
    range: { start: [Object], end: [Object] }
  }
]
References result: [
  {
    "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/edge-case-no-references-3zIKjg/workflow.xxp",
    "range": {
      "start": {
        "line": 1,
        "character": 16
      },
      "end": {
        "line": 1,
        "character": 26
      }
    }
  }
]
Expected definition: workflow.xxp:2:17-27
Actual definition ranges:
  [0] 2:17-27 in file:////tmp/lsp-def-ref-tests-jdqhso/edge-case-no-references-3zikjg/workflow.xxp
✅ Definition test passed at workflow.xxp:2:17-27
Expected 1 references, got 1
Expected references:
  [0] workflow.xxp:2:17-27
Actual reference ranges:
  [0] 2:17-27 in file:////tmp/lsp-def-ref-tests-jdqhso/edge-case-no-references-3zikjg/workflow.xxp
✅ Found expected reference at workflow.xxp:2:17-27
✅ References test passed
📊 Test edge-case-no-references completed (debug mode)
Cleaned up test directory: /tmp/lsp-def-ref-tests-JDqHso/edge-case-no-references-3zIKjg

=== Running definition/references test: espace-conditional-control ===
Test temp directory: /tmp/lsp-def-ref-tests-JDqHso/espace-conditional-control-KTIz0E
Created file: experiment.espace at /tmp/lsp-def-ref-tests-JDqHso/espace-conditional-control-KTIz0E/experiment.espace
Opening document: experiment.espace -> file:////tmp/lsp-def-ref-tests-JDqHso/espace-conditional-control-KTIz0E/experiment.espace
Document content (first 200 chars):
experiment MyExperiment {
    space s1 of WorkflowA {
        strategy randomSearch;
    }
    
    space s2 of WorkflowB {
        strategy gridSearch;
    }
    
    control {
        start -> s1 -?...
Waiting for document processing...
Testing on: experiment.espace at position {"line":10,"character":18}
Context around request position: " -> s1 -?> s2 {"
Line 10: "        start -> s1 -?> s2 {"
Character 18: "1"
File content with line numbers and character positions:
  0: "experiment MyExperiment {"
     0123456789012345678901234
  1: "    space s1 of WorkflowA {"
     012345678901234567890123456
  2: "        strategy randomSearch;"
     012345678901234567890123456789
  3: "    }"
  4: "    "
  5: "    space s2 of WorkflowB {"
  6: "        strategy gridSearch;"
  7: "    }"
  8: "    "
  9: "    control {"
  10: "        start -> s1 -?> s2 {"
  11: "            condition "accuracy > 0.8";"
  12: "        }"
  13: "        s1 -> end;"
  14: "        s2 -> end;"
  15: "    }"
  16: "}"
Requesting definition for file:////tmp/lsp-def-ref-tests-JDqHso/espace-conditional-control-KTIz0E/experiment.espace at {"line":10,"character":18}
🔍 REFS STDOUT: Content-Length: 229

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":4,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/espace-conditional-control-KTIz0E/experiment.espace at {\"line\":10,\"character\":18}"}}
🔍 REFS STDOUT: Content-Length: 229

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/espace-conditional-control-KTIz0E/experiment.espace at {\"line\":10,\"character\":18}"}}Content-Length: 146

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] TokenPosition: text=\"s1\", context=\"SpaceNameReadContext\""}}Content-Length: 143

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"s1\" in context \"SpaceNameReadContext\""}}Content-Length: 154

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=false"}}Content-Length: 115

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling SpaceNameReadContext"}}
🔍 REFS STDOUT: Content-Length: 134

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Trying experimentSymbol for SpaceNameReadContext"}}Content-Length: 115

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found in experimentSymbol: s1"}}Content-Length: 133

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found symbol: name=\"s1\", type=\"SpaceSymbol\""}}Content-Length: 149

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: symbol=\"s1\", type=\"SpaceSymbol\""}}Content-Length: 154

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: parseTree context=\"SpaceHeaderContext\""}}Content-Length: 165

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: contextName=\"SpaceHeaderContext\", symbolName=\"s1\""}}Content-Length: 140

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: position=1, symbolName=\"s1\""}}Content-Length: 138

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: parseTree.getChildCount()=4"}}Content-Length: 173
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: child at 1: text=\"s1\", isTerminalNode=true, textMatches=true"}}Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: Found matching terminal node"}}Content-Length: 147

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: identifierNode found, text=\"s1\""}}Content-Length: 211

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: RangeUtils result={\"start\":{\"line\":1,\"character\":10},\"end\":{\"line\":1,\"character\":12}}"}}Content-Length: 320

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: Final result={\"uri\":\"file:////tmp/lsp-def-ref-tests-JDqHso/espace-conditional-control-KTIz0E/experiment.espace\",\"range\":{\"start\":{\"line\":1,\"character\":10},\"end\":{\"line\":1,\"character\":12}}}"}}Content-Length: 185

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Generated location: {\"start\":{\"line\":1,\"character\":10},\"end\":{\"line\":1,\"character\":12}}"}}Content-Length: 210

{"jsonrpc":"2.0","id":10,"result":{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/espace-conditional-control-KTIz0E/experiment.espace","range":{"start":{"line":1,"character":10},"end":{"line":1,"character":12}}}}
Definition response: {
  uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/espace-conditional-control-KTIz0E/experiment.espace',
  range: {
    start: { line: 1, character: 10 },
    end: { line: 1, character: 12 }
  }
}
Definition result: {
  "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/espace-conditional-control-KTIz0E/experiment.espace",
  "range": {
    "start": {
      "line": 1,
      "character": 10
    },
    "end": {
      "line": 1,
      "character": 12
    }
  }
}
Requesting references for file:////tmp/lsp-def-ref-tests-JDqHso/espace-conditional-control-KTIz0E/experiment.espace at {"line":10,"character":18}
🔍 REFS STDOUT: Content-Length: 143

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"s1\" in context \"SpaceNameReadContext\""}}Content-Length: 154
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=false"}}Content-Length: 115

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling SpaceNameReadContext"}}Content-Length: 134

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Trying experimentSymbol for SpaceNameReadContext"}}Content-Length: 115

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found in experimentSymbol: s1"}}Content-Length: 149

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: symbol=\"s1\", type=\"SpaceSymbol\""}}Content-Length: 154

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: parseTree context=\"SpaceHeaderContext\""}}
🔍 REFS STDOUT: Content-Length: 165

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: contextName=\"SpaceHeaderContext\", symbolName=\"s1\""}}Content-Length: 140

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: position=1, symbolName=\"s1\""}}Content-Length: 138

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: parseTree.getChildCount()=4"}}Content-Length: 173

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: child at 1: text=\"s1\", isTerminalNode=true, textMatches=true"}}Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: Found matching terminal node"}}Content-Length: 147

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: identifierNode found, text=\"s1\""}}Content-Length: 211
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: RangeUtils result={\"start\":{\"line\":1,\"character\":10},\"end\":{\"line\":1,\"character\":12}}"}}Content-Length: 320

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: Final result={\"uri\":\"file:////tmp/lsp-def-ref-tests-JDqHso/espace-conditional-control-KTIz0E/experiment.espace\",\"range\":{\"start\":{\"line\":1,\"character\":10},\"end\":{\"line\":1,\"character\":12}}}"}}Content-Length: 390

{"jsonrpc":"2.0","id":11,"result":[{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/espace-conditional-control-KTIz0E/experiment.espace","range":{"start":{"line":10,"character":17},"end":{"line":10,"character":19}}},{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/espace-conditional-control-KTIz0E/experiment.espace","range":{"start":{"line":1,"character":10},"end":{"line":1,"character":12}}}]}
References response: [
  {
    uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/espace-conditional-control-KTIz0E/experiment.espace',
    range: { start: [Object], end: [Object] }
  },
  {
    uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/espace-conditional-control-KTIz0E/experiment.espace',
    range: { start: [Object], end: [Object] }
  }
]
References result: [
  {
    "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/espace-conditional-control-KTIz0E/experiment.espace",
    "range": {
      "start": {
        "line": 10,
        "character": 17
      },
      "end": {
        "line": 10,
        "character": 19
      }
    }
  },
  {
    "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/espace-conditional-control-KTIz0E/experiment.espace",
    "range": {
      "start": {
        "line": 1,
        "character": 10
      },
      "end": {
        "line": 1,
        "character": 12
      }
    }
  }
]
Expected definition: experiment.espace:2:11-13
Actual definition ranges:
  [0] 2:11-13 in file:////tmp/lsp-def-ref-tests-jdqhso/espace-conditional-control-ktiz0e/experiment.espace
✅ Definition test passed at experiment.espace:2:11-13
Expected 3 references, got 2
Expected references:
  [0] experiment.espace:2:11-13
  [1] experiment.espace:11:18-20
  [2] experiment.espace:14:9-11
Actual reference ranges:
  [0] 11:18-20 in file:////tmp/lsp-def-ref-tests-jdqhso/espace-conditional-control-ktiz0e/experiment.espace
  [1] 2:11-13 in file:////tmp/lsp-def-ref-tests-jdqhso/espace-conditional-control-ktiz0e/experiment.espace
✅ Found expected reference at experiment.espace:2:11-13
✅ Found expected reference at experiment.espace:11:18-20
❌ Missing expected reference at experiment.espace:14:9-11
📊 Test espace-conditional-control failed: Error: References test failed - missing expected references at: experiment.espace:14:9-11
Cleaned up test directory: /tmp/lsp-def-ref-tests-JDqHso/espace-conditional-control-KTIz0E

=== Running definition/references test: espace-data-definition ===
Test temp directory: /tmp/lsp-def-ref-tests-JDqHso/espace-data-definition-PvVEQc
Created file: experiment.espace at /tmp/lsp-def-ref-tests-JDqHso/espace-data-definition-PvVEQc/experiment.espace
Opening document: experiment.espace -> file:////tmp/lsp-def-ref-tests-JDqHso/espace-data-definition-PvVEQc/experiment.espace
Document content (first 200 chars):
experiment MyExperiment {
    define data experimentData = "experiment.csv";
    
    space s1 of SimpleWorkflow {
        strategy randomSearch;
        define data spaceData = "space.csv";
    }
   ...
Waiting for document processing...
Testing on: experiment.espace at position {"line":1,"character":23}
Context around request position: "perimentData = "
Line 1: "    define data experimentData = "experiment.csv";"
Character 23: "e"
File content with line numbers and character positions:
  0: "experiment MyExperiment {"
     0123456789012345678901234
  1: "    define data experimentData = "experiment.csv";"
     01234567890123456789012345678901234567890123456789
  2: "    "
     0123
  3: "    space s1 of SimpleWorkflow {"
  4: "        strategy randomSearch;"
  5: "        define data spaceData = "space.csv";"
  6: "    }"
  7: "    "
  8: "    control {"
  9: "        start -> s1 -> end;"
  10: "    }"
  11: "}"
Requesting definition for file:////tmp/lsp-def-ref-tests-JDqHso/espace-data-definition-PvVEQc/experiment.espace at {"line":1,"character":23}
🔍 REFS STDOUT: Content-Length: 224

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":4,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/espace-data-definition-PvVEQc/experiment.espace at {\"line\":1,\"character\":23}"}}
🔍 REFS STDOUT: Content-Length: 224

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/espace-data-definition-PvVEQc/experiment.espace at {\"line\":1,\"character\":23}"}}Content-Length: 159

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] TokenPosition: text=\"experimentData\", context=\"DataDefinitionContext\""}}Content-Length: 156

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"experimentData\" in context \"DataDefinitionContext\""}}Content-Length: 154

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=false"}}Content-Length: 116

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling DataDefinitionContext"}}Content-Length: 141

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] DataDefinitionContext: No workflowSymbolTable available"}}
🔍 REFS STDOUT: Content-Length: 145

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Using default resolution for context: DataDefinitionContext"}}Content-Length: 122

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default: Trying document.symbolTable"}}Content-Length: 119

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default: Trying folderSymbolTable"}}
🔍 REFS STDOUT: Content-Length: 141

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default resolution failed: No symbol found in any table"}}Content-Length: 124

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] No symbol found for \"experimentData\""}}Content-Length: 39

{"jsonrpc":"2.0","id":12,"result":null}
Definition response: null
Definition result: null
Requesting references for file:////tmp/lsp-def-ref-tests-JDqHso/espace-data-definition-PvVEQc/experiment.espace at {"line":1,"character":23}
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":3,"message":"[2025-06-25T12:44:52.874Z] [INFO] Received references request for document: file:////tmp/lsp-def-ref-tests-JDqHso/espace-data-definition-PvVEQc/experiment.espace"}}Content-Length: 156

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"experimentData\" in context \"DataDefinitionContext\""}}
🔍 REFS STDOUT: Content-Length: 154

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=false"}}Content-Length: 116

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling DataDefinitionContext"}}Content-Length: 141

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] DataDefinitionContext: No workflowSymbolTable available"}}Content-Length: 145

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Using default resolution for context: DataDefinitionContext"}}Content-Length: 122

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default: Trying document.symbolTable"}}Content-Length: 119

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default: Trying folderSymbolTable"}}
🔍 REFS STDOUT: Content-Length: 141

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default resolution failed: No symbol found in any table"}}Content-Length: 39

{"jsonrpc":"2.0","id":13,"result":null}
References response: null
References result: null
📊 Test espace-data-definition failed: Error: expect(received).not.toBeNull()

Received: null
Cleaned up test directory: /tmp/lsp-def-ref-tests-JDqHso/espace-data-definition-PvVEQc

=== Running definition/references test: espace-experiment-definition ===
Test temp directory: /tmp/lsp-def-ref-tests-JDqHso/espace-experiment-definition-w7GOPp
Created file: experiment.espace at /tmp/lsp-def-ref-tests-JDqHso/espace-experiment-definition-w7GOPp/experiment.espace
Opening document: experiment.espace -> file:////tmp/lsp-def-ref-tests-JDqHso/espace-experiment-definition-w7GOPp/experiment.espace
Document content (first 200 chars):
experiment MyExperiment {
    space s1 of SimpleWorkflow {
        strategy randomSearch;
    }
    
    control {
        start -> s1 -> end;
    }
}
Waiting for document processing...
Testing on: experiment.espace at position {"line":0,"character":17}
Context around request position: "yExperiment {"
Line 0: "experiment MyExperiment {"
Character 17: "r"
File content with line numbers and character positions:
  0: "experiment MyExperiment {"
     0123456789012345678901234
  1: "    space s1 of SimpleWorkflow {"
     01234567890123456789012345678901
  2: "        strategy randomSearch;"
     012345678901234567890123456789
  3: "    }"
  4: "    "
  5: "    control {"
  6: "        start -> s1 -> end;"
  7: "    }"
  8: "}"
Requesting definition for file:////tmp/lsp-def-ref-tests-JDqHso/espace-experiment-definition-w7GOPp/experiment.espace at {"line":0,"character":17}
🔍 REFS STDOUT: Content-Length: 230

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":4,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/espace-experiment-definition-w7GOPp/experiment.espace at {\"line\":0,\"character\":17}"}}
🔍 REFS STDOUT: Content-Length: 230

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/espace-experiment-definition-w7GOPp/experiment.espace at {\"line\":0,\"character\":17}"}}Content-Length: 159

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] TokenPosition: text=\"MyExperiment\", context=\"ExperimentHeaderContext\""}}Content-Length: 156

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"MyExperiment\" in context \"ExperimentHeaderContext\""}}Content-Length: 154

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=false"}}Content-Length: 118
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling ExperimentHeaderContext"}}Content-Length: 141

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Trying document.symbolTable for ExperimentHeaderContext"}}Content-Length: 120

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found in symbolTable: MyExperiment"}}
🔍 REFS STDOUT: Content-Length: 148

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found symbol: name=\"MyExperiment\", type=\"ExperimentSymbol\""}}Content-Length: 164

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: symbol=\"MyExperiment\", type=\"ExperimentSymbol\""}}Content-Length: 164

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: parseTree context=\"ExperimentDeclarationContext\""}}Content-Length: 185

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: contextName=\"ExperimentDeclarationContext\", symbolName=\"MyExperiment\""}}
🔍 REFS STDOUT: Content-Length: 152

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: Using ExperimentDeclarationContext logic"}}Content-Length: 163

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] ExperimentDeclarationContext: Found ExperimentHeaderContext child, delegating"}}Content-Length: 150

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: position=1, symbolName=\"MyExperiment\""}}Content-Length: 138

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: parseTree.getChildCount()=2"}}
🔍 REFS STDOUT: Content-Length: 183

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: child at 1: text=\"MyExperiment\", isTerminalNode=true, textMatches=true"}}Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: Found matching terminal node"}}Content-Length: 157

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: identifierNode found, text=\"MyExperiment\""}}Content-Length: 211

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: RangeUtils result={\"start\":{\"line\":0,\"character\":11},\"end\":{\"line\":0,\"character\":23}}"}}Content-Length: 322

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: Final result={\"uri\":\"file:////tmp/lsp-def-ref-tests-JDqHso/espace-experiment-definition-w7GOPp/experiment.espace\",\"range\":{\"start\":{\"line\":0,\"character\":11},\"end\":{\"line\":0,\"character\":23}}}"}}
🔍 REFS STDOUT: Content-Length: 185

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Generated location: {\"start\":{\"line\":0,\"character\":11},\"end\":{\"line\":0,\"character\":23}}"}}Content-Length: 212

{"jsonrpc":"2.0","id":14,"result":{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/espace-experiment-definition-w7GOPp/experiment.espace","range":{"start":{"line":0,"character":11},"end":{"line":0,"character":23}}}}
Definition response: {
  uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/espace-experiment-definition-w7GOPp/experiment.espace',
  range: {
    start: { line: 0, character: 11 },
    end: { line: 0, character: 23 }
  }
}
Definition result: {
  "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/espace-experiment-definition-w7GOPp/experiment.espace",
  "range": {
    "start": {
      "line": 0,
      "character": 11
    },
    "end": {
      "line": 0,
      "character": 23
    }
  }
}
Requesting references for file:////tmp/lsp-def-ref-tests-JDqHso/espace-experiment-definition-w7GOPp/experiment.espace at {"line":0,"character":17}
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"MyExperiment\" in context \"ExperimentHeaderContext\""}}
🔍 REFS STDOUT: Content-Length: 154

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=false"}}Content-Length: 118

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling ExperimentHeaderContext"}}Content-Length: 141

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Trying document.symbolTable for ExperimentHeaderContext"}}Content-Length: 120

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found in symbolTable: MyExperiment"}}
🔍 REFS STDOUT: Content-Length: 164

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: symbol=\"MyExperiment\", type=\"ExperimentSymbol\""}}Content-Length: 164

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: parseTree context=\"ExperimentDeclarationContext\""}}Content-Length: 185

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: contextName=\"ExperimentDeclarationContext\", symbolName=\"MyExperiment\""}}Content-Length: 152
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: Using ExperimentDeclarationContext logic"}}Content-Length: 163

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] ExperimentDeclarationContext: Found ExperimentHeaderContext child, delegating"}}Content-Length: 150

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: position=1, symbolName=\"MyExperiment\""}}Content-Length: 138

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: parseTree.getChildCount()=2"}}Content-Length: 183

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: child at 1: text=\"MyExperiment\", isTerminalNode=true, textMatches=true"}}
🔍 REFS STDOUT: Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: Found matching terminal node"}}Content-Length: 157

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: identifierNode found, text=\"MyExperiment\""}}Content-Length: 211

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: RangeUtils result={\"start\":{\"line\":0,\"character\":11},\"end\":{\"line\":0,\"character\":23}}"}}Content-Length: 322

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: Final result={\"uri\":\"file:////tmp/lsp-def-ref-tests-JDqHso/espace-experiment-definition-w7GOPp/experiment.espace\",\"range\":{\"start\":{\"line\":0,\"character\":11},\"end\":{\"line\":0,\"character\":23}}}"}}
References response: [
  {
    uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/espace-experiment-definition-w7GOPp/experiment.espace',
    range: { start: [Object], end: [Object] }
  }
]
References result: [
  {
    "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/espace-experiment-definition-w7GOPp/experiment.espace",
    "range": {
      "start": {
        "line": 0,
        "character": 11
      },
      "end": {
        "line": 0,
        "character": 23
      }
    }
  }
]
Expected definition: experiment.espace:1:12-24
Actual definition ranges:
  [0] 1:12-24 in file:////tmp/lsp-def-ref-tests-jdqhso/espace-experiment-definition-w7gopp/experiment.espace
✅ Definition test passed at experiment.espace:1:12-24
Expected 1 references, got 1
Expected references:
  [0] experiment.espace:1:12-24
Actual reference ranges:
  [0] 1:12-24 in file:////tmp/lsp-def-ref-tests-jdqhso/espace-experiment-definition-w7gopp/experiment.espace
✅ Found expected reference at experiment.espace:1:12-24
✅ References test passed
📊 Test espace-experiment-definition completed (debug mode)
Cleaned up test directory: /tmp/lsp-def-ref-tests-JDqHso/espace-experiment-definition-w7GOPp

=== Running definition/references test: espace-param-definition ===
Test temp directory: /tmp/lsp-def-ref-tests-JDqHso/espace-param-definition-uALBVN
Created file: experiment.espace at /tmp/lsp-def-ref-tests-JDqHso/espace-param-definition-uALBVN/experiment.espace
Opening document: experiment.espace -> file:////tmp/lsp-def-ref-tests-JDqHso/espace-param-definition-uALBVN/experiment.espace
Document content (first 200 chars):
experiment MyExperiment {
    space s1 of SimpleWorkflow {
        strategy randomSearch;
        param learningRate = enum(0.01, 0.1, 1.0);
    }
    
    control {
        start -> s1 -> end;
    }
...
Waiting for document processing...
Testing on: experiment.espace at position {"line":3,"character":20}
Context around request position: "earningRate = e"
Line 3: "        param learningRate = enum(0.01, 0.1, 1.0);"
Character 20: "n"
File content with line numbers and character positions:
  0: "experiment MyExperiment {"
     0123456789012345678901234
  1: "    space s1 of SimpleWorkflow {"
     01234567890123456789012345678901
  2: "        strategy randomSearch;"
     012345678901234567890123456789
  3: "        param learningRate = enum(0.01, 0.1, 1.0);"
  4: "    }"
  5: "    "
  6: "    control {"
  7: "        start -> s1 -> end;"
  8: "    }"
  9: "}"
Requesting definition for file:////tmp/lsp-def-ref-tests-JDqHso/espace-param-definition-uALBVN/experiment.espace at {"line":3,"character":20}
🔍 REFS STDOUT: Content-Length: 225

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":4,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/espace-param-definition-uALBVN/experiment.espace at {\"line\":3,\"character\":20}"}}
🔍 REFS STDOUT: Content-Length: 225

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/espace-param-definition-uALBVN/experiment.espace at {\"line\":3,\"character\":20}"}}Content-Length: 158

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] TokenPosition: text=\"learningRate\", context=\"ParamDefinitionContext\""}}Content-Length: 155

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"learningRate\" in context \"ParamDefinitionContext\""}}
🔍 REFS STDOUT: Content-Length: 154

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=false"}}Content-Length: 117

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling ParamDefinitionContext"}}Content-Length: 136

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Trying experimentSymbol for ParamDefinitionContext"}}Content-Length: 145

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] ParamDefinitionContext: No symbol found in experimentSymbol"}}
🔍 REFS STDOUT: Content-Length: 146

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Using default resolution for context: ParamDefinitionContext"}}Content-Length: 122

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default: Trying document.symbolTable"}}Content-Length: 119

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default: Trying folderSymbolTable"}}Content-Length: 141

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default resolution failed: No symbol found in any table"}}
🔍 REFS STDOUT: Content-Length: 122

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] No symbol found for \"learningRate\""}}Content-Length: 39

{"jsonrpc":"2.0","id":16,"result":null}
Definition response: null
Definition result: null
Requesting references for file:////tmp/lsp-def-ref-tests-JDqHso/espace-param-definition-uALBVN/experiment.espace at {"line":3,"character":20}
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"learningRate\" in context \"ParamDefinitionContext\""}}Content-Length: 154

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=false"}}
🔍 REFS STDOUT: Content-Length: 117

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling ParamDefinitionContext"}}Content-Length: 136

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Trying experimentSymbol for ParamDefinitionContext"}}Content-Length: 145

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] ParamDefinitionContext: No symbol found in experimentSymbol"}}Content-Length: 146

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Using default resolution for context: ParamDefinitionContext"}}Content-Length: 122

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default: Trying document.symbolTable"}}Content-Length: 119

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default: Trying folderSymbolTable"}}Content-Length: 141

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default resolution failed: No symbol found in any table"}}
References response: null
References result: null
📊 Test espace-param-definition failed: Error: expect(received).not.toBeNull()

Received: null
Cleaned up test directory: /tmp/lsp-def-ref-tests-JDqHso/espace-param-definition-uALBVN

=== Running definition/references test: espace-space-definition ===
Test temp directory: /tmp/lsp-def-ref-tests-JDqHso/espace-space-definition-KZ6qpe
Created file: experiment.espace at /tmp/lsp-def-ref-tests-JDqHso/espace-space-definition-KZ6qpe/experiment.espace
Opening document: experiment.espace -> file:////tmp/lsp-def-ref-tests-JDqHso/espace-space-definition-KZ6qpe/experiment.espace
Document content (first 200 chars):
experiment MyExperiment {
    space s1 of SimpleWorkflow {
        strategy randomSearch;
    }
    
    control {
        start -> s1 -> end;
    }
}
Waiting for document processing...
Testing on: experiment.espace at position {"line":1,"character":11}
Context around request position: "ace s1 of Simpl"
Line 1: "    space s1 of SimpleWorkflow {"
Character 11: "1"
File content with line numbers and character positions:
  0: "experiment MyExperiment {"
     0123456789012345678901234
  1: "    space s1 of SimpleWorkflow {"
     01234567890123456789012345678901
  2: "        strategy randomSearch;"
     012345678901234567890123456789
  3: "    }"
  4: "    "
  5: "    control {"
  6: "        start -> s1 -> end;"
  7: "    }"
  8: "}"
Requesting definition for file:////tmp/lsp-def-ref-tests-JDqHso/espace-space-definition-KZ6qpe/experiment.espace at {"line":1,"character":11}
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":4,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/espace-space-definition-KZ6qpe/experiment.espace at {\"line\":1,\"character\":11}"}}Content-Length: 225

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/espace-space-definition-KZ6qpe/experiment.espace at {\"line\":1,\"character\":11}"}}
🔍 REFS STDOUT: Content-Length: 144

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] TokenPosition: text=\"s1\", context=\"SpaceHeaderContext\""}}Content-Length: 141

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"s1\" in context \"SpaceHeaderContext\""}}Content-Length: 154

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=false"}}Content-Length: 113

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling SpaceHeaderContext"}}
🔍 REFS STDOUT: Content-Length: 132

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Trying experimentSymbol for SpaceHeaderContext"}}Content-Length: 115

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found in experimentSymbol: s1"}}Content-Length: 133

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found symbol: name=\"s1\", type=\"SpaceSymbol\""}}Content-Length: 149

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: symbol=\"s1\", type=\"SpaceSymbol\""}}
🔍 REFS STDOUT: Content-Length: 154

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: parseTree context=\"SpaceHeaderContext\""}}Content-Length: 165

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: contextName=\"SpaceHeaderContext\", symbolName=\"s1\""}}Content-Length: 140

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: position=1, symbolName=\"s1\""}}Content-Length: 138
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: parseTree.getChildCount()=4"}}Content-Length: 173

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: child at 1: text=\"s1\", isTerminalNode=true, textMatches=true"}}Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: Found matching terminal node"}}Content-Length: 147

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: identifierNode found, text=\"s1\""}}Content-Length: 211

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: RangeUtils result={\"start\":{\"line\":1,\"character\":10},\"end\":{\"line\":1,\"character\":12}}"}}Content-Length: 317

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: Final result={\"uri\":\"file:////tmp/lsp-def-ref-tests-JDqHso/espace-space-definition-KZ6qpe/experiment.espace\",\"range\":{\"start\":{\"line\":1,\"character\":10},\"end\":{\"line\":1,\"character\":12}}}"}}
🔍 REFS STDOUT: Content-Length: 185

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Generated location: {\"start\":{\"line\":1,\"character\":10},\"end\":{\"line\":1,\"character\":12}}"}}Content-Length: 207

{"jsonrpc":"2.0","id":18,"result":{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/espace-space-definition-KZ6qpe/experiment.espace","range":{"start":{"line":1,"character":10},"end":{"line":1,"character":12}}}}
Definition response: {
  uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/espace-space-definition-KZ6qpe/experiment.espace',
  range: {
    start: { line: 1, character: 10 },
    end: { line: 1, character: 12 }
  }
}
Definition result: {
  "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/espace-space-definition-KZ6qpe/experiment.espace",
  "range": {
    "start": {
      "line": 1,
      "character": 10
    },
    "end": {
      "line": 1,
      "character": 12
    }
  }
}
Requesting references for file:////tmp/lsp-def-ref-tests-JDqHso/espace-space-definition-KZ6qpe/experiment.espace at {"line":1,"character":11}
🔍 REFS STDOUT: Content-Length: 141

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"s1\" in context \"SpaceHeaderContext\""}}Content-Length: 154
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=false"}}Content-Length: 113

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling SpaceHeaderContext"}}Content-Length: 132

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Trying experimentSymbol for SpaceHeaderContext"}}Content-Length: 115

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found in experimentSymbol: s1"}}Content-Length: 149

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: symbol=\"s1\", type=\"SpaceSymbol\""}}Content-Length: 154

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: parseTree context=\"SpaceHeaderContext\""}}
🔍 REFS STDOUT: Content-Length: 165

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: contextName=\"SpaceHeaderContext\", symbolName=\"s1\""}}Content-Length: 140

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: position=1, symbolName=\"s1\""}}Content-Length: 138

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: parseTree.getChildCount()=4"}}Content-Length: 173
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: child at 1: text=\"s1\", isTerminalNode=true, textMatches=true"}}Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: Found matching terminal node"}}Content-Length: 147

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: identifierNode found, text=\"s1\""}}Content-Length: 211

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: RangeUtils result={\"start\":{\"line\":1,\"character\":10},\"end\":{\"line\":1,\"character\":12}}"}}Content-Length: 317

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: Final result={\"uri\":\"file:////tmp/lsp-def-ref-tests-JDqHso/espace-space-definition-KZ6qpe/experiment.espace\",\"range\":{\"start\":{\"line\":1,\"character\":10},\"end\":{\"line\":1,\"character\":12}}}"}}
References response: [
  {
    uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/espace-space-definition-KZ6qpe/experiment.espace',
    range: { start: [Object], end: [Object] }
  },
  {
    uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/espace-space-definition-KZ6qpe/experiment.espace',
    range: { start: [Object], end: [Object] }
  }
]
References result: [
  {
    "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/espace-space-definition-KZ6qpe/experiment.espace",
    "range": {
      "start": {
        "line": 6,
        "character": 17
      },
      "end": {
        "line": 6,
        "character": 19
      }
    }
  },
  {
    "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/espace-space-definition-KZ6qpe/experiment.espace",
    "range": {
      "start": {
        "line": 1,
        "character": 10
      },
      "end": {
        "line": 1,
        "character": 12
      }
    }
  }
]
Expected definition: experiment.espace:2:11-13
Actual definition ranges:
  [0] 2:11-13 in file:////tmp/lsp-def-ref-tests-jdqhso/espace-space-definition-kz6qpe/experiment.espace
✅ Definition test passed at experiment.espace:2:11-13
Expected 2 references, got 2
Expected references:
  [0] experiment.espace:2:11-13
  [1] experiment.espace:7:18-20
Actual reference ranges:
  [0] 7:18-20 in file:////tmp/lsp-def-ref-tests-jdqhso/espace-space-definition-kz6qpe/experiment.espace
  [1] 2:11-13 in file:////tmp/lsp-def-ref-tests-jdqhso/espace-space-definition-kz6qpe/experiment.espace
✅ Found expected reference at experiment.espace:2:11-13
✅ Found expected reference at experiment.espace:7:18-20
✅ References test passed
📊 Test espace-space-definition completed (debug mode)
Cleaned up test directory: /tmp/lsp-def-ref-tests-JDqHso/espace-space-definition-KZ6qpe

=== Running definition/references test: espace-space-usage ===
Test temp directory: /tmp/lsp-def-ref-tests-JDqHso/espace-space-usage-FVuIyW
Created file: experiment.espace at /tmp/lsp-def-ref-tests-JDqHso/espace-space-usage-FVuIyW/experiment.espace
Opening document: experiment.espace -> file:////tmp/lsp-def-ref-tests-JDqHso/espace-space-usage-FVuIyW/experiment.espace
Document content (first 200 chars):
experiment MyExperiment {
    space s1 of SimpleWorkflow {
        strategy randomSearch;
    }
    
    control {
        start -> s1 -> end;
    }
}
Waiting for document processing...
Testing on: experiment.espace at position {"line":6,"character":18}
Context around request position: " -> s1 -> end;"
Line 6: "        start -> s1 -> end;"
Character 18: "1"
File content with line numbers and character positions:
  0: "experiment MyExperiment {"
     0123456789012345678901234
  1: "    space s1 of SimpleWorkflow {"
     01234567890123456789012345678901
  2: "        strategy randomSearch;"
     012345678901234567890123456789
  3: "    }"
  4: "    "
  5: "    control {"
  6: "        start -> s1 -> end;"
  7: "    }"
  8: "}"
Requesting definition for file:////tmp/lsp-def-ref-tests-JDqHso/espace-space-usage-FVuIyW/experiment.espace at {"line":6,"character":18}
🔍 REFS STDOUT: Content-Length: 220

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":4,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/espace-space-usage-FVuIyW/experiment.espace at {\"line\":6,\"character\":18}"}}
🔍 REFS STDOUT: Content-Length: 220

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/espace-space-usage-FVuIyW/experiment.espace at {\"line\":6,\"character\":18}"}}Content-Length: 146

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] TokenPosition: text=\"s1\", context=\"SpaceNameReadContext\""}}Content-Length: 143

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"s1\" in context \"SpaceNameReadContext\""}}Content-Length: 154

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=false"}}Content-Length: 115

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling SpaceNameReadContext"}}Content-Length: 134

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Trying experimentSymbol for SpaceNameReadContext"}}Content-Length: 115

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found in experimentSymbol: s1"}}Content-Length: 133
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found symbol: name=\"s1\", type=\"SpaceSymbol\""}}Content-Length: 149

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: symbol=\"s1\", type=\"SpaceSymbol\""}}Content-Length: 154

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: parseTree context=\"SpaceHeaderContext\""}}Content-Length: 165

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: contextName=\"SpaceHeaderContext\", symbolName=\"s1\""}}Content-Length: 140

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: position=1, symbolName=\"s1\""}}Content-Length: 138

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: parseTree.getChildCount()=4"}}Content-Length: 173

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: child at 1: text=\"s1\", isTerminalNode=true, textMatches=true"}}
🔍 REFS STDOUT: Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: Found matching terminal node"}}Content-Length: 147

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: identifierNode found, text=\"s1\""}}Content-Length: 211

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: RangeUtils result={\"start\":{\"line\":1,\"character\":10},\"end\":{\"line\":1,\"character\":12}}"}}Content-Length: 312

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: Final result={\"uri\":\"file:////tmp/lsp-def-ref-tests-JDqHso/espace-space-usage-FVuIyW/experiment.espace\",\"range\":{\"start\":{\"line\":1,\"character\":10},\"end\":{\"line\":1,\"character\":12}}}"}}Content-Length: 185

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Generated location: {\"start\":{\"line\":1,\"character\":10},\"end\":{\"line\":1,\"character\":12}}"}}Content-Length: 202

{"jsonrpc":"2.0","id":20,"result":{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/espace-space-usage-FVuIyW/experiment.espace","range":{"start":{"line":1,"character":10},"end":{"line":1,"character":12}}}}
Definition response: {
  uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/espace-space-usage-FVuIyW/experiment.espace',
  range: {
    start: { line: 1, character: 10 },
    end: { line: 1, character: 12 }
  }
}
Definition result: {
  "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/espace-space-usage-FVuIyW/experiment.espace",
  "range": {
    "start": {
      "line": 1,
      "character": 10
    },
    "end": {
      "line": 1,
      "character": 12
    }
  }
}
Requesting references for file:////tmp/lsp-def-ref-tests-JDqHso/espace-space-usage-FVuIyW/experiment.espace at {"line":6,"character":18}
🔍 REFS STDOUT: Content-Length: 143

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"s1\" in context \"SpaceNameReadContext\""}}Content-Length: 154

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=false"}}
🔍 REFS STDOUT: Content-Length: 115

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling SpaceNameReadContext"}}Content-Length: 134

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Trying experimentSymbol for SpaceNameReadContext"}}Content-Length: 115

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found in experimentSymbol: s1"}}Content-Length: 149

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: symbol=\"s1\", type=\"SpaceSymbol\""}}Content-Length: 154

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: parseTree context=\"SpaceHeaderContext\""}}Content-Length: 165

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: contextName=\"SpaceHeaderContext\", symbolName=\"s1\""}}Content-Length: 140

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: position=1, symbolName=\"s1\""}}Content-Length: 138

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: parseTree.getChildCount()=4"}}Content-Length: 173

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: child at 1: text=\"s1\", isTerminalNode=true, textMatches=true"}}
🔍 REFS STDOUT: Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: Found matching terminal node"}}Content-Length: 147

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: identifierNode found, text=\"s1\""}}Content-Length: 211

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: RangeUtils result={\"start\":{\"line\":1,\"character\":10},\"end\":{\"line\":1,\"character\":12}}"}}Content-Length: 312

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: Final result={\"uri\":\"file:////tmp/lsp-def-ref-tests-JDqHso/espace-space-usage-FVuIyW/experiment.espace\",\"range\":{\"start\":{\"line\":1,\"character\":10},\"end\":{\"line\":1,\"character\":12}}}"}}Content-Length: 372

{"jsonrpc":"2.0","id":21,"result":[{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/espace-space-usage-FVuIyW/experiment.espace","range":{"start":{"line":6,"character":17},"end":{"line":6,"character":19}}},{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/espace-space-usage-FVuIyW/experiment.espace","range":{"start":{"line":1,"character":10},"end":{"line":1,"character":12}}}]}
References response: [
  {
    uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/espace-space-usage-FVuIyW/experiment.espace',
    range: { start: [Object], end: [Object] }
  },
  {
    uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/espace-space-usage-FVuIyW/experiment.espace',
    range: { start: [Object], end: [Object] }
  }
]
References result: [
  {
    "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/espace-space-usage-FVuIyW/experiment.espace",
    "range": {
      "start": {
        "line": 6,
        "character": 17
      },
      "end": {
        "line": 6,
        "character": 19
      }
    }
  },
  {
    "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/espace-space-usage-FVuIyW/experiment.espace",
    "range": {
      "start": {
        "line": 1,
        "character": 10
      },
      "end": {
        "line": 1,
        "character": 12
      }
    }
  }
]
Expected definition: experiment.espace:2:11-13
Actual definition ranges:
  [0] 2:11-13 in file:////tmp/lsp-def-ref-tests-jdqhso/espace-space-usage-fvuiyw/experiment.espace
✅ Definition test passed at experiment.espace:2:11-13
Expected 2 references, got 2
Expected references:
  [0] experiment.espace:2:11-13
  [1] experiment.espace:7:18-20
Actual reference ranges:
  [0] 7:18-20 in file:////tmp/lsp-def-ref-tests-jdqhso/espace-space-usage-fvuiyw/experiment.espace
  [1] 2:11-13 in file:////tmp/lsp-def-ref-tests-jdqhso/espace-space-usage-fvuiyw/experiment.espace
✅ Found expected reference at experiment.espace:2:11-13
✅ Found expected reference at experiment.espace:7:18-20
✅ References test passed
📊 Test espace-space-usage completed (debug mode)
Cleaned up test directory: /tmp/lsp-def-ref-tests-JDqHso/espace-space-usage-FVuIyW

=== Running definition/references test: espace-task-from-workflow ===
Test temp directory: /tmp/lsp-def-ref-tests-JDqHso/espace-task-from-workflow-RKWdvn
Created file: SimpleWorkflow.xxp at /tmp/lsp-def-ref-tests-JDqHso/espace-task-from-workflow-RKWdvn/SimpleWorkflow.xxp
Created file: experiment.espace at /tmp/lsp-def-ref-tests-JDqHso/espace-task-from-workflow-RKWdvn/experiment.espace
Opening document: SimpleWorkflow.xxp -> file:////tmp/lsp-def-ref-tests-JDqHso/espace-task-from-workflow-RKWdvn/SimpleWorkflow.xxp
Document content (first 200 chars):
workflow SimpleWorkflow {
    define task myTask;
    define task anotherTask;
    
    configure task myTask {}

    START -> myTask -> anotherTask -> END;
}
Opening document: experiment.espace -> file:////tmp/lsp-def-ref-tests-JDqHso/espace-task-from-workflow-RKWdvn/experiment.espace
Document content (first 200 chars):
experiment MyExperiment {
    space s1 of SimpleWorkflow {
        strategy randomSearch;
        
        configure task myTask {
            param threshold = 0.5;
        }
    }
    
    control {...
Waiting for document processing...
Testing on: experiment.espace at position {"line":4,"character":26}
Context around request position: "k myTask {"
Line 4: "        configure task myTask {"
Character 26: "a"
File content with line numbers and character positions:
  0: "experiment MyExperiment {"
     0123456789012345678901234
  1: "    space s1 of SimpleWorkflow {"
     01234567890123456789012345678901
  2: "        strategy randomSearch;"
     012345678901234567890123456789
  3: "        "
  4: "        configure task myTask {"
  5: "            param threshold = 0.5;"
  6: "        }"
  7: "    }"
  8: "    "
  9: "    control {"
  10: "        start -> s1 -> end;"
  11: "    }"
  12: "}"
Requesting definition for file:////tmp/lsp-def-ref-tests-JDqHso/espace-task-from-workflow-RKWdvn/experiment.espace at {"line":4,"character":26}
🔍 REFS STDOUT: Content-Length: 227

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":4,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/espace-task-from-workflow-RKWdvn/experiment.espace at {\"line\":4,\"character\":26}"}}
🔍 REFS STDOUT: Content-Length: 227

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/espace-task-from-workflow-RKWdvn/experiment.espace at {\"line\":4,\"character\":26}"}}Content-Length: 149

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] TokenPosition: text=\"myTask\", context=\"TaskNameReadContext\""}}Content-Length: 146

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"myTask\" in context \"TaskNameReadContext\""}}Content-Length: 154

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=false"}}
🔍 REFS STDOUT: Content-Length: 114

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling TaskNameReadContext"}}Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Trying local experimentSymbol for TaskNameReadContext"}}Content-Length: 136

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Trying workflow references for TaskNameReadContext"}}Content-Length: 154

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] TaskNameReadContext: No symbol found in local or workflow references"}}Content-Length: 143

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Using default resolution for context: TaskNameReadContext"}}Content-Length: 122

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default: Trying document.symbolTable"}}Content-Length: 119

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default: Trying folderSymbolTable"}}
🔍 REFS STDOUT: Content-Length: 141

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default resolution failed: No symbol found in any table"}}Content-Length: 116

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] No symbol found for \"myTask\""}}Content-Length: 39

{"jsonrpc":"2.0","id":22,"result":null}
Definition response: null
Definition result: null
Requesting references for file:////tmp/lsp-def-ref-tests-JDqHso/espace-task-from-workflow-RKWdvn/experiment.espace at {"line":4,"character":26}
🔍 REFS STDOUT: Content-Length: 146

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"myTask\" in context \"TaskNameReadContext\""}}
🔍 REFS STDOUT: Content-Length: 154

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=false"}}Content-Length: 114

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling TaskNameReadContext"}}Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Trying local experimentSymbol for TaskNameReadContext"}}Content-Length: 136

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Trying workflow references for TaskNameReadContext"}}Content-Length: 154

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] TaskNameReadContext: No symbol found in local or workflow references"}}Content-Length: 143

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Using default resolution for context: TaskNameReadContext"}}Content-Length: 122

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default: Trying document.symbolTable"}}Content-Length: 119
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default: Trying folderSymbolTable"}}Content-Length: 141

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default resolution failed: No symbol found in any table"}}Content-Length: 39

{"jsonrpc":"2.0","id":23,"result":null}
References response: null
References result: null
📊 Test espace-task-from-workflow failed: Error: expect(received).not.toBeNull()

Received: null
Cleaned up test directory: /tmp/lsp-def-ref-tests-JDqHso/espace-task-from-workflow-RKWdvn

=== Running definition/references test: espace-workflow-reference ===
Test temp directory: /tmp/lsp-def-ref-tests-JDqHso/espace-workflow-reference-5ol0HN
Created file: SimpleWorkflow.xxp at /tmp/lsp-def-ref-tests-JDqHso/espace-workflow-reference-5ol0HN/SimpleWorkflow.xxp
Created file: experiment.espace at /tmp/lsp-def-ref-tests-JDqHso/espace-workflow-reference-5ol0HN/experiment.espace
Opening document: SimpleWorkflow.xxp -> file:////tmp/lsp-def-ref-tests-JDqHso/espace-workflow-reference-5ol0HN/SimpleWorkflow.xxp
Document content (first 200 chars):
workflow SimpleWorkflow {
    define task myTask;
    
    configure task myTask {}

    START -> myTask -> END;
}
Opening document: experiment.espace -> file:////tmp/lsp-def-ref-tests-JDqHso/espace-workflow-reference-5ol0HN/experiment.espace
Document content (first 200 chars):
experiment MyExperiment {
    space s1 of SimpleWorkflow {
        strategy randomSearch;
    }
    
    control {
        start -> s1 -> end;
    }
}
Waiting for document processing...
Testing on: experiment.espace at position {"line":1,"character":23}
Context around request position: "mpleWorkflow {"
Line 1: "    space s1 of SimpleWorkflow {"
Character 23: "o"
File content with line numbers and character positions:
  0: "experiment MyExperiment {"
     0123456789012345678901234
  1: "    space s1 of SimpleWorkflow {"
     01234567890123456789012345678901
  2: "        strategy randomSearch;"
     012345678901234567890123456789
  3: "    }"
  4: "    "
  5: "    control {"
  6: "        start -> s1 -> end;"
  7: "    }"
  8: "}"
Requesting definition for file:////tmp/lsp-def-ref-tests-JDqHso/espace-workflow-reference-5ol0HN/experiment.espace at {"line":1,"character":23}
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":4,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/espace-workflow-reference-5ol0HN/experiment.espace at {\"line\":1,\"character\":23}"}}
🔍 REFS STDOUT: Content-Length: 227

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/espace-workflow-reference-5ol0HN/experiment.espace at {\"line\":1,\"character\":23}"}}Content-Length: 161

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] TokenPosition: text=\"SimpleWorkflow\", context=\"WorkflowNameReadContext\""}}Content-Length: 158

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"SimpleWorkflow\" in context \"WorkflowNameReadContext\""}}Content-Length: 154

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=false"}}Content-Length: 118
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling WorkflowNameReadContext"}}Content-Length: 138

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Trying folderSymbolTable for WorkflowNameReadContext"}}Content-Length: 128

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found in folderSymbolTable: SimpleWorkflow"}}Content-Length: 148

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found symbol: name=\"SimpleWorkflow\", type=\"WorkflowSymbol\""}}Content-Length: 164

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: symbol=\"SimpleWorkflow\", type=\"WorkflowSymbol\""}}Content-Length: 162

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: parseTree context=\"WorkflowDeclarationContext\""}}Content-Length: 185
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: contextName=\"WorkflowDeclarationContext\", symbolName=\"SimpleWorkflow\""}}Content-Length: 150

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: Using WorkflowDeclarationContext logic"}}Content-Length: 159

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] WorkflowDeclarationContext: Found WorkflowHeaderContext child, delegating"}}Content-Length: 152

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: position=1, symbolName=\"SimpleWorkflow\""}}Content-Length: 138
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: parseTree.getChildCount()=2"}}Content-Length: 185

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: child at 1: text=\"SimpleWorkflow\", isTerminalNode=true, textMatches=true"}}Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: Found matching terminal node"}}Content-Length: 159

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: identifierNode found, text=\"SimpleWorkflow\""}}
🔍 REFS STDOUT: Content-Length: 210

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: RangeUtils result={\"start\":{\"line\":0,\"character\":9},\"end\":{\"line\":0,\"character\":23}}"}}Content-Length: 319

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: Final result={\"uri\":\"file:////tmp/lsp-def-ref-tests-JDqHso/espace-workflow-reference-5ol0HN/SimpleWorkflow.xxp\",\"range\":{\"start\":{\"line\":0,\"character\":9},\"end\":{\"line\":0,\"character\":23}}}"}}Content-Length: 184

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Generated location: {\"start\":{\"line\":0,\"character\":9},\"end\":{\"line\":0,\"character\":23}}"}}Content-Length: 209

{"jsonrpc":"2.0","id":24,"result":{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/espace-workflow-reference-5ol0HN/SimpleWorkflow.xxp","range":{"start":{"line":0,"character":9},"end":{"line":0,"character":23}}}}
Definition response: {
  uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/espace-workflow-reference-5ol0HN/SimpleWorkflow.xxp',
  range: { start: { line: 0, character: 9 }, end: { line: 0, character: 23 } }
}
Definition result: {
  "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/espace-workflow-reference-5ol0HN/SimpleWorkflow.xxp",
  "range": {
    "start": {
      "line": 0,
      "character": 9
    },
    "end": {
      "line": 0,
      "character": 23
    }
  }
}
Requesting references for file:////tmp/lsp-def-ref-tests-JDqHso/espace-workflow-reference-5ol0HN/experiment.espace at {"line":1,"character":23}
🔍 REFS STDOUT: Content-Length: 158

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"SimpleWorkflow\" in context \"WorkflowNameReadContext\""}}
🔍 REFS STDOUT: Content-Length: 154

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=false"}}Content-Length: 118

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling WorkflowNameReadContext"}}Content-Length: 138

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Trying folderSymbolTable for WorkflowNameReadContext"}}Content-Length: 128

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found in folderSymbolTable: SimpleWorkflow"}}Content-Length: 164

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: symbol=\"SimpleWorkflow\", type=\"WorkflowSymbol\""}}Content-Length: 162

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: parseTree context=\"WorkflowDeclarationContext\""}}
🔍 REFS STDOUT: Content-Length: 185

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: contextName=\"WorkflowDeclarationContext\", symbolName=\"SimpleWorkflow\""}}Content-Length: 150

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: Using WorkflowDeclarationContext logic"}}Content-Length: 159

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] WorkflowDeclarationContext: Found WorkflowHeaderContext child, delegating"}}Content-Length: 152

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: position=1, symbolName=\"SimpleWorkflow\""}}Content-Length: 138

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: parseTree.getChildCount()=2"}}Content-Length: 185
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: child at 1: text=\"SimpleWorkflow\", isTerminalNode=true, textMatches=true"}}Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: Found matching terminal node"}}Content-Length: 159

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: identifierNode found, text=\"SimpleWorkflow\""}}Content-Length: 210

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: RangeUtils result={\"start\":{\"line\":0,\"character\":9},\"end\":{\"line\":0,\"character\":23}}"}}Content-Length: 319
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: Final result={\"uri\":\"file:////tmp/lsp-def-ref-tests-JDqHso/espace-workflow-reference-5ol0HN/SimpleWorkflow.xxp\",\"range\":{\"start\":{\"line\":0,\"character\":9},\"end\":{\"line\":0,\"character\":23}}}"}}Content-Length: 386

{"jsonrpc":"2.0","id":25,"result":[{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/espace-workflow-reference-5ol0HN/experiment.espace","range":{"start":{"line":1,"character":16},"end":{"line":1,"character":30}}},{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/espace-workflow-reference-5ol0HN/SimpleWorkflow.xxp","range":{"start":{"line":0,"character":9},"end":{"line":0,"character":23}}}]}
References response: [
  {
    uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/espace-workflow-reference-5ol0HN/experiment.espace',
    range: { start: [Object], end: [Object] }
  },
  {
    uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/espace-workflow-reference-5ol0HN/SimpleWorkflow.xxp',
    range: { start: [Object], end: [Object] }
  }
]
References result: [
  {
    "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/espace-workflow-reference-5ol0HN/experiment.espace",
    "range": {
      "start": {
        "line": 1,
        "character": 16
      },
      "end": {
        "line": 1,
        "character": 30
      }
    }
  },
  {
    "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/espace-workflow-reference-5ol0HN/SimpleWorkflow.xxp",
    "range": {
      "start": {
        "line": 0,
        "character": 9
      },
      "end": {
        "line": 0,
        "character": 23
      }
    }
  }
]
Expected definition: SimpleWorkflow.xxp:1:10-24
Actual definition ranges:
  [0] 1:10-24 in file:////tmp/lsp-def-ref-tests-jdqhso/espace-workflow-reference-5ol0hn/simpleworkflow.xxp
✅ Definition test passed at SimpleWorkflow.xxp:1:10-24
Expected 2 references, got 2
Expected references:
  [0] SimpleWorkflow.xxp:1:10-24
  [1] experiment.espace:11:19-33
Actual reference ranges:
  [0] 2:17-31 in file:////tmp/lsp-def-ref-tests-jdqhso/espace-workflow-reference-5ol0hn/experiment.espace
  [1] 1:10-24 in file:////tmp/lsp-def-ref-tests-jdqhso/espace-workflow-reference-5ol0hn/simpleworkflow.xxp
✅ Found expected reference at SimpleWorkflow.xxp:1:10-24
❌ Missing expected reference at experiment.espace:11:19-33
📊 Test espace-workflow-reference failed: Error: References test failed - missing expected references at: experiment.espace:11:19-33
Cleaned up test directory: /tmp/lsp-def-ref-tests-JDqHso/espace-workflow-reference-5ol0HN

=== Running definition/references test: mixed-inheritance-with-experiment ===
Test temp directory: /tmp/lsp-def-ref-tests-JDqHso/mixed-inheritance-with-experiment-pnDbFY
Created file: BaseML.xxp at /tmp/lsp-def-ref-tests-JDqHso/mixed-inheritance-with-experiment-pnDbFY/BaseML.xxp
Created file: AdvancedML.xxp at /tmp/lsp-def-ref-tests-JDqHso/mixed-inheritance-with-experiment-pnDbFY/AdvancedML.xxp
Created file: Experiment.espace at /tmp/lsp-def-ref-tests-JDqHso/mixed-inheritance-with-experiment-pnDbFY/Experiment.espace
Opening document: BaseML.xxp -> file:////tmp/lsp-def-ref-tests-JDqHso/mixed-inheritance-with-experiment-pnDbFY/BaseML.xxp
Document content (first 200 chars):
workflow BaseML {
    define task preprocess;
    define task train;
    
    configure task preprocess {}
    configure task train {}

    START -> preprocess -> train -> END;
}
Opening document: AdvancedML.xxp -> file:////tmp/lsp-def-ref-tests-JDqHso/mixed-inheritance-with-experiment-pnDbFY/AdvancedML.xxp
Document content (first 200 chars):
workflow AdvancedML from BaseML {
    define task postprocess;
    
    configure task postprocess {}

    START -> preprocess -> train -> postprocess -> END;
}
Opening document: Experiment.espace -> file:////tmp/lsp-def-ref-tests-JDqHso/mixed-inheritance-with-experiment-pnDbFY/Experiment.espace
Document content (first 200 chars):
experiment MLExperiment {
    space advanced of AdvancedML {
        strategy bayesianOptimization;
    }
    
    control {
        start -> advanced -> end;
    }
}
Waiting for document processing...
Testing on: AdvancedML.xxp at position {"line":0,"character":28}
Context around request position: "m BaseML {"
Line 0: "workflow AdvancedML from BaseML {"
Character 28: "e"
File content with line numbers and character positions:
  0: "workflow AdvancedML from BaseML {"
     012345678901234567890123456789012
  1: "    define task postprocess;"
     0123456789012345678901234567
  2: "    "
     0123
  3: "    configure task postprocess {}"
  4: ""
  5: "    START -> preprocess -> train -> postprocess -> END;"
  6: "}"
Requesting definition for file:////tmp/lsp-def-ref-tests-JDqHso/mixed-inheritance-with-experiment-pnDbFY/AdvancedML.xxp at {"line":0,"character":28}
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":4,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/mixed-inheritance-with-experiment-pnDbFY/AdvancedML.xxp at {\"line\":0,\"character\":28}"}}
🔍 REFS STDOUT: Content-Length: 232

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/mixed-inheritance-with-experiment-pnDbFY/AdvancedML.xxp at {\"line\":0,\"character\":28}"}}Content-Length: 153

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] TokenPosition: text=\"BaseML\", context=\"WorkflowNameReadContext\""}}Content-Length: 150

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"BaseML\" in context \"WorkflowNameReadContext\""}}Content-Length: 153

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=true"}}Content-Length: 118

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling WorkflowNameReadContext"}}Content-Length: 138

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Trying folderSymbolTable for WorkflowNameReadContext"}}
🔍 REFS STDOUT: Content-Length: 120

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found in folderSymbolTable: BaseML"}}Content-Length: 140

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found symbol: name=\"BaseML\", type=\"WorkflowSymbol\""}}Content-Length: 156

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: symbol=\"BaseML\", type=\"WorkflowSymbol\""}}Content-Length: 162

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: parseTree context=\"WorkflowDeclarationContext\""}}Content-Length: 177

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: contextName=\"WorkflowDeclarationContext\", symbolName=\"BaseML\""}}Content-Length: 150

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: Using WorkflowDeclarationContext logic"}}
🔍 REFS STDOUT: Content-Length: 159

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] WorkflowDeclarationContext: Found WorkflowHeaderContext child, delegating"}}Content-Length: 144

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: position=1, symbolName=\"BaseML\""}}Content-Length: 138

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: parseTree.getChildCount()=2"}}Content-Length: 177

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: child at 1: text=\"BaseML\", isTerminalNode=true, textMatches=true"}}Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: Found matching terminal node"}}
🔍 REFS STDOUT: Content-Length: 151

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: identifierNode found, text=\"BaseML\""}}Content-Length: 210

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: RangeUtils result={\"start\":{\"line\":0,\"character\":9},\"end\":{\"line\":0,\"character\":15}}"}}Content-Length: 319

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: Final result={\"uri\":\"file:////tmp/lsp-def-ref-tests-JDqHso/mixed-inheritance-with-experiment-pnDbFY/BaseML.xxp\",\"range\":{\"start\":{\"line\":0,\"character\":9},\"end\":{\"line\":0,\"character\":15}}}"}}Content-Length: 184

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Generated location: {\"start\":{\"line\":0,\"character\":9},\"end\":{\"line\":0,\"character\":15}}"}}Content-Length: 209

{"jsonrpc":"2.0","id":26,"result":{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/mixed-inheritance-with-experiment-pnDbFY/BaseML.xxp","range":{"start":{"line":0,"character":9},"end":{"line":0,"character":15}}}}
Definition response: {
  uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/mixed-inheritance-with-experiment-pnDbFY/BaseML.xxp',
  range: { start: { line: 0, character: 9 }, end: { line: 0, character: 15 } }
}
Definition result: {
  "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/mixed-inheritance-with-experiment-pnDbFY/BaseML.xxp",
  "range": {
    "start": {
      "line": 0,
      "character": 9
    },
    "end": {
      "line": 0,
      "character": 15
    }
  }
}
Requesting references for file:////tmp/lsp-def-ref-tests-JDqHso/mixed-inheritance-with-experiment-pnDbFY/AdvancedML.xxp at {"line":0,"character":28}
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"BaseML\" in context \"WorkflowNameReadContext\""}}
🔍 REFS STDOUT: Content-Length: 153

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=true"}}Content-Length: 118

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling WorkflowNameReadContext"}}Content-Length: 138

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Trying folderSymbolTable for WorkflowNameReadContext"}}Content-Length: 120

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found in folderSymbolTable: BaseML"}}Content-Length: 156

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: symbol=\"BaseML\", type=\"WorkflowSymbol\""}}
🔍 REFS STDOUT: Content-Length: 162

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: parseTree context=\"WorkflowDeclarationContext\""}}Content-Length: 177

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: contextName=\"WorkflowDeclarationContext\", symbolName=\"BaseML\""}}Content-Length: 150

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: Using WorkflowDeclarationContext logic"}}Content-Length: 159

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] WorkflowDeclarationContext: Found WorkflowHeaderContext child, delegating"}}Content-Length: 144

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: position=1, symbolName=\"BaseML\""}}Content-Length: 138
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: parseTree.getChildCount()=2"}}Content-Length: 177

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: child at 1: text=\"BaseML\", isTerminalNode=true, textMatches=true"}}Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: Found matching terminal node"}}Content-Length: 151

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: identifierNode found, text=\"BaseML\""}}Content-Length: 210

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: RangeUtils result={\"start\":{\"line\":0,\"character\":9},\"end\":{\"line\":0,\"character\":15}}"}}Content-Length: 319

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: Final result={\"uri\":\"file:////tmp/lsp-def-ref-tests-JDqHso/mixed-inheritance-with-experiment-pnDbFY/BaseML.xxp\",\"range\":{\"start\":{\"line\":0,\"character\":9},\"end\":{\"line\":0,\"character\":15}}}"}}
References response: [
  {
    uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/mixed-inheritance-with-experiment-pnDbFY/AdvancedML.xxp',
    range: { start: [Object], end: [Object] }
  },
  {
    uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/mixed-inheritance-with-experiment-pnDbFY/BaseML.xxp',
    range: { start: [Object], end: [Object] }
  }
]
References result: [
  {
    "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/mixed-inheritance-with-experiment-pnDbFY/AdvancedML.xxp",
    "range": {
      "start": {
        "line": 0,
        "character": 25
      },
      "end": {
        "line": 0,
        "character": 31
      }
    }
  },
  {
    "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/mixed-inheritance-with-experiment-pnDbFY/BaseML.xxp",
    "range": {
      "start": {
        "line": 0,
        "character": 9
      },
      "end": {
        "line": 0,
        "character": 15
      }
    }
  }
]
Expected definition: BaseML.xxp:1:10-16
Actual definition ranges:
  [0] 1:10-16 in file:////tmp/lsp-def-ref-tests-jdqhso/mixed-inheritance-with-experiment-pndbfy/baseml.xxp
✅ Definition test passed at BaseML.xxp:1:10-16
Expected 2 references, got 2
Expected references:
  [0] BaseML.xxp:1:10-16
  [1] AdvancedML.xxp:12:27-33
Actual reference ranges:
  [0] 1:26-32 in file:////tmp/lsp-def-ref-tests-jdqhso/mixed-inheritance-with-experiment-pndbfy/advancedml.xxp
  [1] 1:10-16 in file:////tmp/lsp-def-ref-tests-jdqhso/mixed-inheritance-with-experiment-pndbfy/baseml.xxp
✅ Found expected reference at BaseML.xxp:1:10-16
❌ Missing expected reference at AdvancedML.xxp:12:27-33
📊 Test mixed-inheritance-with-experiment failed: Error: References test failed - missing expected references at: AdvancedML.xxp:12:27-33
Cleaned up test directory: /tmp/lsp-def-ref-tests-JDqHso/mixed-inheritance-with-experiment-pnDbFY

=== Running definition/references test: mixed-task-cross-reference ===
Test temp directory: /tmp/lsp-def-ref-tests-JDqHso/mixed-task-cross-reference-0Kia6S
Created file: MLWorkflow.xxp at /tmp/lsp-def-ref-tests-JDqHso/mixed-task-cross-reference-0Kia6S/MLWorkflow.xxp
Created file: MLExperiment.espace at /tmp/lsp-def-ref-tests-JDqHso/mixed-task-cross-reference-0Kia6S/MLExperiment.espace
Opening document: MLWorkflow.xxp -> file:////tmp/lsp-def-ref-tests-JDqHso/mixed-task-cross-reference-0Kia6S/MLWorkflow.xxp
Document content (first 200 chars):
workflow MLWorkflow {
    define task train;
    define task evaluate;
    
    configure task train {}
    configure task evaluate {}

    START -> train -> evaluate -> END;
}
Opening document: MLExperiment.espace -> file:////tmp/lsp-def-ref-tests-JDqHso/mixed-task-cross-reference-0Kia6S/MLExperiment.espace
Document content (first 200 chars):
experiment MLExperiment {
    space training of MLWorkflow {
        strategy randomSearch;
        
        configure task train {
            param epochs = range(10, 100, 10);
        }
    }
    
...
Waiting for document processing...
Testing on: MLExperiment.espace at position {"line":4,"character":25}
Context around request position: "sk train {"
Line 4: "        configure task train {"
Character 25: "a"
File content with line numbers and character positions:
  0: "experiment MLExperiment {"
     0123456789012345678901234
  1: "    space training of MLWorkflow {"
     0123456789012345678901234567890123
  2: "        strategy randomSearch;"
     012345678901234567890123456789
  3: "        "
  4: "        configure task train {"
  5: "            param epochs = range(10, 100, 10);"
  6: "        }"
  7: "    }"
  8: "    "
  9: "    control {"
  10: "        start -> training -> end;"
  11: "    }"
  12: "}"
Requesting definition for file:////tmp/lsp-def-ref-tests-JDqHso/mixed-task-cross-reference-0Kia6S/MLExperiment.espace at {"line":4,"character":25}
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":4,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/mixed-task-cross-reference-0Kia6S/MLExperiment.espace at {\"line\":4,\"character\":25}"}}
🔍 REFS STDOUT: Content-Length: 230

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/mixed-task-cross-reference-0Kia6S/MLExperiment.espace at {\"line\":4,\"character\":25}"}}Content-Length: 148

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] TokenPosition: text=\"train\", context=\"TaskNameReadContext\""}}Content-Length: 145

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"train\" in context \"TaskNameReadContext\""}}
🔍 REFS STDOUT: Content-Length: 154

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=false"}}Content-Length: 114

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling TaskNameReadContext"}}Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Trying local experimentSymbol for TaskNameReadContext"}}Content-Length: 136

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Trying workflow references for TaskNameReadContext"}}
🔍 REFS STDOUT: Content-Length: 154

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] TaskNameReadContext: No symbol found in local or workflow references"}}Content-Length: 143

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Using default resolution for context: TaskNameReadContext"}}
🔍 REFS STDOUT: Content-Length: 122

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default: Trying document.symbolTable"}}Content-Length: 119

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default: Trying folderSymbolTable"}}Content-Length: 141

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default resolution failed: No symbol found in any table"}}Content-Length: 115

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] No symbol found for \"train\""}}Content-Length: 39

{"jsonrpc":"2.0","id":28,"result":null}
Definition response: null
Definition result: null
Requesting references for file:////tmp/lsp-def-ref-tests-JDqHso/mixed-task-cross-reference-0Kia6S/MLExperiment.espace at {"line":4,"character":25}
🔍 REFS STDOUT: [2025-06-25T12:44:59.588Z] [INFO] Received references request for document: file:////tmp/lsp-def-ref-tests-JDqHso/mixed-task-cross-reference-0Kia6S/MLExperiment.espace
Content-Length: 246

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":3,"message":"[2025-06-25T12:44:59.588Z] [INFO] Received references request for document: file:////tmp/lsp-def-ref-tests-JDqHso/mixed-task-cross-reference-0Kia6S/MLExperiment.espace"}}Content-Length: 145

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"train\" in context \"TaskNameReadContext\""}}Content-Length: 154

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=false"}}Content-Length: 114

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling TaskNameReadContext"}}Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Trying local experimentSymbol for TaskNameReadContext"}}Content-Length: 136

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Trying workflow references for TaskNameReadContext"}}Content-Length: 154

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] TaskNameReadContext: No symbol found in local or workflow references"}}Content-Length: 143

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Using default resolution for context: TaskNameReadContext"}}Content-Length: 122

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default: Trying document.symbolTable"}}Content-Length: 119

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default: Trying folderSymbolTable"}}Content-Length: 141

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default resolution failed: No symbol found in any table"}}Content-Length: 39

{"jsonrpc":"2.0","id":29,"result":null}
References response: null
References result: null
📊 Test mixed-task-cross-reference failed: Error: expect(received).not.toBeNull()

Received: null
Cleaned up test directory: /tmp/lsp-def-ref-tests-JDqHso/mixed-task-cross-reference-0Kia6S

=== Running definition/references test: mixed-workflow-experiment ===
Test temp directory: /tmp/lsp-def-ref-tests-JDqHso/mixed-workflow-experiment-sukPPv
Created file: DataProcessing.xxp at /tmp/lsp-def-ref-tests-JDqHso/mixed-workflow-experiment-sukPPv/DataProcessing.xxp
Created file: MLExperiment.espace at /tmp/lsp-def-ref-tests-JDqHso/mixed-workflow-experiment-sukPPv/MLExperiment.espace
Opening document: DataProcessing.xxp -> file:////tmp/lsp-def-ref-tests-JDqHso/mixed-workflow-experiment-sukPPv/DataProcessing.xxp
Document content (first 200 chars):
workflow DataProcessing {
    define data inputData = "data.csv";
    define task preprocess;
    define task analyze;
    
    configure task preprocess {
        input inputData;
    }
    
    conf...
Opening document: MLExperiment.espace -> file:////tmp/lsp-def-ref-tests-JDqHso/mixed-workflow-experiment-sukPPv/MLExperiment.espace
Document content (first 200 chars):
experiment MLExperiment {
    space preprocessing of DataProcessing {
        strategy exhaustive;
        
        configure task preprocess {
            param normalizeData = true;
        }
    }
...
Waiting for document processing...
Testing on: MLExperiment.espace at position {"line":1,"character":34}
Context around request position: "taProcessing {"
Line 1: "    space preprocessing of DataProcessing {"
Character 34: "c"
File content with line numbers and character positions:
  0: "experiment MLExperiment {"
     0123456789012345678901234
  1: "    space preprocessing of DataProcessing {"
     0123456789012345678901234567890123456789012
  2: "        strategy exhaustive;"
     0123456789012345678901234567
  3: "        "
  4: "        configure task preprocess {"
  5: "            param normalizeData = true;"
  6: "        }"
  7: "    }"
  8: "    "
  9: "    control {"
  10: "        start -> preprocessing -> end;"
  11: "    }"
  12: "}"
Requesting definition for file:////tmp/lsp-def-ref-tests-JDqHso/mixed-workflow-experiment-sukPPv/MLExperiment.espace at {"line":1,"character":34}
🔍 REFS STDOUT: Content-Length: 229

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":4,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/mixed-workflow-experiment-sukPPv/MLExperiment.espace at {\"line\":1,\"character\":34}"}}
🔍 REFS STDOUT: Content-Length: 229

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/mixed-workflow-experiment-sukPPv/MLExperiment.espace at {\"line\":1,\"character\":34}"}}Content-Length: 161

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] TokenPosition: text=\"DataProcessing\", context=\"WorkflowNameReadContext\""}}Content-Length: 158

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"DataProcessing\" in context \"WorkflowNameReadContext\""}}Content-Length: 154

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=false"}}Content-Length: 118

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling WorkflowNameReadContext"}}Content-Length: 138

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Trying folderSymbolTable for WorkflowNameReadContext"}}Content-Length: 128

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found in folderSymbolTable: DataProcessing"}}
🔍 REFS STDOUT: Content-Length: 148

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found symbol: name=\"DataProcessing\", type=\"WorkflowSymbol\""}}Content-Length: 164

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: symbol=\"DataProcessing\", type=\"WorkflowSymbol\""}}Content-Length: 162

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: parseTree context=\"WorkflowDeclarationContext\""}}Content-Length: 185

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: contextName=\"WorkflowDeclarationContext\", symbolName=\"DataProcessing\""}}Content-Length: 150

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: Using WorkflowDeclarationContext logic"}}Content-Length: 159

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] WorkflowDeclarationContext: Found WorkflowHeaderContext child, delegating"}}Content-Length: 152

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: position=1, symbolName=\"DataProcessing\""}}Content-Length: 138

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: parseTree.getChildCount()=2"}}Content-Length: 185

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: child at 1: text=\"DataProcessing\", isTerminalNode=true, textMatches=true"}}Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: Found matching terminal node"}}
🔍 REFS STDOUT: Content-Length: 159

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: identifierNode found, text=\"DataProcessing\""}}Content-Length: 210

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: RangeUtils result={\"start\":{\"line\":0,\"character\":9},\"end\":{\"line\":0,\"character\":23}}"}}Content-Length: 319

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: Final result={\"uri\":\"file:////tmp/lsp-def-ref-tests-JDqHso/mixed-workflow-experiment-sukPPv/DataProcessing.xxp\",\"range\":{\"start\":{\"line\":0,\"character\":9},\"end\":{\"line\":0,\"character\":23}}}"}}Content-Length: 184

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Generated location: {\"start\":{\"line\":0,\"character\":9},\"end\":{\"line\":0,\"character\":23}}"}}Content-Length: 209

{"jsonrpc":"2.0","id":30,"result":{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/mixed-workflow-experiment-sukPPv/DataProcessing.xxp","range":{"start":{"line":0,"character":9},"end":{"line":0,"character":23}}}}
Definition response: {
  uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/mixed-workflow-experiment-sukPPv/DataProcessing.xxp',
  range: { start: { line: 0, character: 9 }, end: { line: 0, character: 23 } }
}
Definition result: {
  "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/mixed-workflow-experiment-sukPPv/DataProcessing.xxp",
  "range": {
    "start": {
      "line": 0,
      "character": 9
    },
    "end": {
      "line": 0,
      "character": 23
    }
  }
}
Requesting references for file:////tmp/lsp-def-ref-tests-JDqHso/mixed-workflow-experiment-sukPPv/MLExperiment.espace at {"line":1,"character":34}
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":3,"message":"[2025-06-25T12:45:00.377Z] [INFO] Received references request for document: file:////tmp/lsp-def-ref-tests-JDqHso/mixed-workflow-experiment-sukPPv/MLExperiment.espace"}}Content-Length: 158

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"DataProcessing\" in context \"WorkflowNameReadContext\""}}
🔍 REFS STDOUT: Content-Length: 154

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=false"}}Content-Length: 118

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling WorkflowNameReadContext"}}Content-Length: 138

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Trying folderSymbolTable for WorkflowNameReadContext"}}Content-Length: 128

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found in folderSymbolTable: DataProcessing"}}Content-Length: 164

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: symbol=\"DataProcessing\", type=\"WorkflowSymbol\""}}Content-Length: 162

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: parseTree context=\"WorkflowDeclarationContext\""}}Content-Length: 185

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: contextName=\"WorkflowDeclarationContext\", symbolName=\"DataProcessing\""}}
🔍 REFS STDOUT: Content-Length: 150

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: Using WorkflowDeclarationContext logic"}}Content-Length: 159

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] WorkflowDeclarationContext: Found WorkflowHeaderContext child, delegating"}}Content-Length: 152

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: position=1, symbolName=\"DataProcessing\""}}Content-Length: 138

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: parseTree.getChildCount()=2"}}Content-Length: 185

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: child at 1: text=\"DataProcessing\", isTerminalNode=true, textMatches=true"}}Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: Found matching terminal node"}}Content-Length: 159

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: identifierNode found, text=\"DataProcessing\""}}Content-Length: 210
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: RangeUtils result={\"start\":{\"line\":0,\"character\":9},\"end\":{\"line\":0,\"character\":23}}"}}Content-Length: 319

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: Final result={\"uri\":\"file:////tmp/lsp-def-ref-tests-JDqHso/mixed-workflow-experiment-sukPPv/DataProcessing.xxp\",\"range\":{\"start\":{\"line\":0,\"character\":9},\"end\":{\"line\":0,\"character\":23}}}"}}Content-Length: 388

{"jsonrpc":"2.0","id":31,"result":[{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/mixed-workflow-experiment-sukPPv/MLExperiment.espace","range":{"start":{"line":1,"character":27},"end":{"line":1,"character":41}}},{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/mixed-workflow-experiment-sukPPv/DataProcessing.xxp","range":{"start":{"line":0,"character":9},"end":{"line":0,"character":23}}}]}
References response: [
  {
    uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/mixed-workflow-experiment-sukPPv/MLExperiment.espace',
    range: { start: [Object], end: [Object] }
  },
  {
    uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/mixed-workflow-experiment-sukPPv/DataProcessing.xxp',
    range: { start: [Object], end: [Object] }
  }
]
References result: [
  {
    "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/mixed-workflow-experiment-sukPPv/MLExperiment.espace",
    "range": {
      "start": {
        "line": 1,
        "character": 27
      },
      "end": {
        "line": 1,
        "character": 41
      }
    }
  },
  {
    "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/mixed-workflow-experiment-sukPPv/DataProcessing.xxp",
    "range": {
      "start": {
        "line": 0,
        "character": 9
      },
      "end": {
        "line": 0,
        "character": 23
      }
    }
  }
]
Expected definition: DataProcessing.xxp:1:10-24
Actual definition ranges:
  [0] 1:10-24 in file:////tmp/lsp-def-ref-tests-jdqhso/mixed-workflow-experiment-sukppv/dataprocessing.xxp
✅ Definition test passed at DataProcessing.xxp:1:10-24
Expected 2 references, got 2
Expected references:
  [0] DataProcessing.xxp:1:10-24
  [1] MLExperiment.espace:18:18-32
Actual reference ranges:
  [0] 2:28-42 in file:////tmp/lsp-def-ref-tests-jdqhso/mixed-workflow-experiment-sukppv/mlexperiment.espace
  [1] 1:10-24 in file:////tmp/lsp-def-ref-tests-jdqhso/mixed-workflow-experiment-sukppv/dataprocessing.xxp
✅ Found expected reference at DataProcessing.xxp:1:10-24
❌ Missing expected reference at MLExperiment.espace:18:18-32
📊 Test mixed-workflow-experiment failed: Error: References test failed - missing expected references at: MLExperiment.espace:18:18-32
Cleaned up test directory: /tmp/lsp-def-ref-tests-JDqHso/mixed-workflow-experiment-sukPPv

=== Running definition/references test: xxp-complex-task-chain ===
Test temp directory: /tmp/lsp-def-ref-tests-JDqHso/xxp-complex-task-chain-iggyK0
Created file: workflow.xxp at /tmp/lsp-def-ref-tests-JDqHso/xxp-complex-task-chain-iggyK0/workflow.xxp
Opening document: workflow.xxp -> file:////tmp/lsp-def-ref-tests-JDqHso/xxp-complex-task-chain-iggyK0/workflow.xxp
Document content (first 200 chars):
workflow ComplexWorkflow {
    define task taskA;
    define task taskB;
    define task taskC;
    
    configure task taskA {}
    configure task taskB {}
    configure task taskC {}

    START -> t...
Waiting for document processing...
Testing on: workflow.xxp at position {"line":10,"character":15}
Context around request position: "-> taskA -> tas"
Line 10: "    START -> taskA -> taskC -> END;"
Character 15: "s"
File content with line numbers and character positions:
  0: "workflow ComplexWorkflow {"
     01234567890123456789012345
  1: "    define task taskA;"
     0123456789012345678901
  2: "    define task taskB;"
     0123456789012345678901
  3: "    define task taskC;"
  4: "    "
  5: "    configure task taskA {}"
  6: "    configure task taskB {}"
  7: "    configure task taskC {}"
  8: ""
  9: "    START -> taskA -> taskB -> taskC -> END;"
  10: "    START -> taskA -> taskC -> END;"
  11: "}"
Requesting definition for file:////tmp/lsp-def-ref-tests-JDqHso/xxp-complex-task-chain-iggyK0/workflow.xxp at {"line":10,"character":15}
🔍 REFS STDOUT: Content-Length: 220

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":4,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/xxp-complex-task-chain-iggyK0/workflow.xxp at {\"line\":10,\"character\":15}"}}
🔍 REFS STDOUT: Content-Length: 220

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/xxp-complex-task-chain-iggyK0/workflow.xxp at {\"line\":10,\"character\":15}"}}Content-Length: 148

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] TokenPosition: text=\"taskA\", context=\"TaskNameReadContext\""}}Content-Length: 145

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"taskA\" in context \"TaskNameReadContext\""}}Content-Length: 153
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=true"}}Content-Length: 114

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling TaskNameReadContext"}}Content-Length: 136

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] TaskNameReadContext: No experimentSymbol available"}}Content-Length: 143

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Using default resolution for context: TaskNameReadContext"}}Content-Length: 130

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default: Trying document.workflowSymbolTable"}}Content-Length: 130

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default: Found in workflowSymbolTable: taskA"}}
🔍 REFS STDOUT: Content-Length: 135

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found symbol: name=\"taskA\", type=\"TaskSymbol\""}}Content-Length: 151

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: symbol=\"taskA\", type=\"TaskSymbol\""}}Content-Length: 157

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: parseTree context=\"TaskDefinitionContext\""}}
🔍 REFS STDOUT: Content-Length: 171

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: contextName=\"TaskDefinitionContext\", symbolName=\"taskA\""}}Content-Length: 143

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: position=2, symbolName=\"taskA\""}}Content-Length: 138

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: parseTree.getChildCount()=4"}}
🔍 REFS STDOUT: Content-Length: 176

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: child at 2: text=\"taskA\", isTerminalNode=true, textMatches=true"}}Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: Found matching terminal node"}}Content-Length: 150

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: identifierNode found, text=\"taskA\""}}Content-Length: 211

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: RangeUtils result={\"start\":{\"line\":1,\"character\":16},\"end\":{\"line\":1,\"character\":21}}"}}
🔍 REFS STDOUT: Content-Length: 311

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: Final result={\"uri\":\"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-complex-task-chain-iggyK0/workflow.xxp\",\"range\":{\"start\":{\"line\":1,\"character\":16},\"end\":{\"line\":1,\"character\":21}}}"}}Content-Length: 185

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Generated location: {\"start\":{\"line\":1,\"character\":16},\"end\":{\"line\":1,\"character\":21}}"}}Content-Length: 201

{"jsonrpc":"2.0","id":32,"result":{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-complex-task-chain-iggyK0/workflow.xxp","range":{"start":{"line":1,"character":16},"end":{"line":1,"character":21}}}}
Definition response: {
  uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/xxp-complex-task-chain-iggyK0/workflow.xxp',
  range: {
    start: { line: 1, character: 16 },
    end: { line: 1, character: 21 }
  }
}
Definition result: {
  "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/xxp-complex-task-chain-iggyK0/workflow.xxp",
  "range": {
    "start": {
      "line": 1,
      "character": 16
    },
    "end": {
      "line": 1,
      "character": 21
    }
  }
}
Requesting references for file:////tmp/lsp-def-ref-tests-JDqHso/xxp-complex-task-chain-iggyK0/workflow.xxp at {"line":10,"character":15}
🔍 REFS STDOUT: Content-Length: 145

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"taskA\" in context \"TaskNameReadContext\""}}Content-Length: 153
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=true"}}Content-Length: 114

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling TaskNameReadContext"}}Content-Length: 136

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] TaskNameReadContext: No experimentSymbol available"}}Content-Length: 143

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Using default resolution for context: TaskNameReadContext"}}Content-Length: 130

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default: Trying document.workflowSymbolTable"}}Content-Length: 130

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default: Found in workflowSymbolTable: taskA"}}Content-Length: 151

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: symbol=\"taskA\", type=\"TaskSymbol\""}}Content-Length: 157

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: parseTree context=\"TaskDefinitionContext\""}}Content-Length: 171

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: contextName=\"TaskDefinitionContext\", symbolName=\"taskA\""}}
🔍 REFS STDOUT: Content-Length: 143

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: position=2, symbolName=\"taskA\""}}Content-Length: 138

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: parseTree.getChildCount()=4"}}Content-Length: 176

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: child at 2: text=\"taskA\", isTerminalNode=true, textMatches=true"}}Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: Found matching terminal node"}}Content-Length: 150

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: identifierNode found, text=\"taskA\""}}Content-Length: 211

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: RangeUtils result={\"start\":{\"line\":1,\"character\":16},\"end\":{\"line\":1,\"character\":21}}"}}Content-Length: 311

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: Final result={\"uri\":\"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-complex-task-chain-iggyK0/workflow.xxp\",\"range\":{\"start\":{\"line\":1,\"character\":16},\"end\":{\"line\":1,\"character\":21}}}"}}
References response: [
  {
    uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/xxp-complex-task-chain-iggyK0/workflow.xxp',
    range: { start: [Object], end: [Object] }
  },
  {
    uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/xxp-complex-task-chain-iggyK0/workflow.xxp',
    range: { start: [Object], end: [Object] }
  },
  {
    uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/xxp-complex-task-chain-iggyK0/workflow.xxp',
    range: { start: [Object], end: [Object] }
  },
  {
    uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/xxp-complex-task-chain-iggyK0/workflow.xxp',
    range: { start: [Object], end: [Object] }
  }
]
References result: [
  {
    "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/xxp-complex-task-chain-iggyK0/workflow.xxp",
    "range": {
      "start": {
        "line": 5,
        "character": 19
      },
      "end": {
        "line": 5,
        "character": 24
      }
    }
  },
  {
    "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/xxp-complex-task-chain-iggyK0/workflow.xxp",
    "range": {
      "start": {
        "line": 9,
        "character": 13
      },
      "end": {
        "line": 9,
        "character": 18
      }
    }
  },
  {
    "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/xxp-complex-task-chain-iggyK0/workflow.xxp",
    "range": {
      "start": {
        "line": 10,
        "character": 13
      },
      "end": {
        "line": 10,
        "character": 18
      }
    }
  },
  {
    "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/xxp-complex-task-chain-iggyK0/workflow.xxp",
    "range": {
      "start": {
        "line": 1,
        "character": 16
      },
      "end": {
        "line": 1,
        "character": 21
      }
    }
  }
]
Expected definition: workflow.xxp:2:17-22
Actual definition ranges:
  [0] 2:17-22 in file:////tmp/lsp-def-ref-tests-jdqhso/xxp-complex-task-chain-iggyk0/workflow.xxp
✅ Definition test passed at workflow.xxp:2:17-22
Expected 4 references, got 4
Expected references:
  [0] workflow.xxp:2:17-22
  [1] workflow.xxp:6:20-25
  [2] workflow.xxp:10:14-19
  [3] workflow.xxp:11:14-19
Actual reference ranges:
  [0] 6:20-25 in file:////tmp/lsp-def-ref-tests-jdqhso/xxp-complex-task-chain-iggyk0/workflow.xxp
  [1] 10:14-19 in file:////tmp/lsp-def-ref-tests-jdqhso/xxp-complex-task-chain-iggyk0/workflow.xxp
  [2] 11:14-19 in file:////tmp/lsp-def-ref-tests-jdqhso/xxp-complex-task-chain-iggyk0/workflow.xxp
  [3] 2:17-22 in file:////tmp/lsp-def-ref-tests-jdqhso/xxp-complex-task-chain-iggyk0/workflow.xxp
✅ Found expected reference at workflow.xxp:2:17-22
✅ Found expected reference at workflow.xxp:6:20-25
✅ Found expected reference at workflow.xxp:10:14-19
✅ Found expected reference at workflow.xxp:11:14-19
✅ References test passed
📊 Test xxp-complex-task-chain completed (debug mode)
Cleaned up test directory: /tmp/lsp-def-ref-tests-JDqHso/xxp-complex-task-chain-iggyK0

=== Running definition/references test: xxp-data-definition ===
Test temp directory: /tmp/lsp-def-ref-tests-JDqHso/xxp-data-definition-bxtkxB
Created file: workflow.xxp at /tmp/lsp-def-ref-tests-JDqHso/xxp-data-definition-bxtkxB/workflow.xxp
Opening document: workflow.xxp -> file:////tmp/lsp-def-ref-tests-JDqHso/xxp-data-definition-bxtkxB/workflow.xxp
Document content (first 200 chars):
workflow DataWorkflow {
    define data inputData = "test.csv";
    define task processTask;
    
    configure task processTask {
        input inputData;
    }

    START -> processTask -> END;
}
Waiting for document processing...
Testing on: workflow.xxp at position {"line":1,"character":20}
Context around request position: " inputData = "t"
Line 1: "    define data inputData = "test.csv";"
Character 20: "t"
File content with line numbers and character positions:
  0: "workflow DataWorkflow {"
     01234567890123456789012
  1: "    define data inputData = "test.csv";"
     012345678901234567890123456789012345678
  2: "    define task processTask;"
     0123456789012345678901234567
  3: "    "
  4: "    configure task processTask {"
  5: "        input inputData;"
  6: "    }"
  7: ""
  8: "    START -> processTask -> END;"
  9: "}"
Requesting definition for file:////tmp/lsp-def-ref-tests-JDqHso/xxp-data-definition-bxtkxB/workflow.xxp at {"line":1,"character":20}
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":4,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/xxp-data-definition-bxtkxB/workflow.xxp at {\"line\":1,\"character\":20}"}}Content-Length: 216
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/xxp-data-definition-bxtkxB/workflow.xxp at {\"line\":1,\"character\":20}"}}Content-Length: 154

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] TokenPosition: text=\"inputData\", context=\"DataDefinitionContext\""}}Content-Length: 151

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"inputData\" in context \"DataDefinitionContext\""}}Content-Length: 153

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=true"}}Content-Length: 116

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling DataDefinitionContext"}}Content-Length: 147

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Trying document.workflowSymbolTable for DataDefinitionContext"}}Content-Length: 125

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found in workflowSymbolTable: inputData"}}Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found symbol: name=\"inputData\", type=\"DataSymbol\""}}Content-Length: 155
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: symbol=\"inputData\", type=\"DataSymbol\""}}Content-Length: 157

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: parseTree context=\"DataDefinitionContext\""}}Content-Length: 175

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: contextName=\"DataDefinitionContext\", symbolName=\"inputData\""}}Content-Length: 147

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: position=2, symbolName=\"inputData\""}}Content-Length: 138

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: parseTree.getChildCount()=6"}}Content-Length: 180

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: child at 2: text=\"inputData\", isTerminalNode=true, textMatches=true"}}Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: Found matching terminal node"}}Content-Length: 154
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: identifierNode found, text=\"inputData\""}}Content-Length: 211

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: RangeUtils result={\"start\":{\"line\":1,\"character\":16},\"end\":{\"line\":1,\"character\":25}}"}}Content-Length: 308

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: Final result={\"uri\":\"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-data-definition-bxtkxB/workflow.xxp\",\"range\":{\"start\":{\"line\":1,\"character\":16},\"end\":{\"line\":1,\"character\":25}}}"}}Content-Length: 185

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Generated location: {\"start\":{\"line\":1,\"character\":16},\"end\":{\"line\":1,\"character\":25}}"}}Content-Length: 198

{"jsonrpc":"2.0","id":34,"result":{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-data-definition-bxtkxB/workflow.xxp","range":{"start":{"line":1,"character":16},"end":{"line":1,"character":25}}}}
Definition response: {
  uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/xxp-data-definition-bxtkxB/workflow.xxp',
  range: {
    start: { line: 1, character: 16 },
    end: { line: 1, character: 25 }
  }
}
Definition result: {
  "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/xxp-data-definition-bxtkxB/workflow.xxp",
  "range": {
    "start": {
      "line": 1,
      "character": 16
    },
    "end": {
      "line": 1,
      "character": 25
    }
  }
}
Requesting references for file:////tmp/lsp-def-ref-tests-JDqHso/xxp-data-definition-bxtkxB/workflow.xxp at {"line":1,"character":20}
🔍 REFS STDOUT: Content-Length: 151

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"inputData\" in context \"DataDefinitionContext\""}}Content-Length: 153

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=true"}}Content-Length: 116

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling DataDefinitionContext"}}Content-Length: 147

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Trying document.workflowSymbolTable for DataDefinitionContext"}}Content-Length: 125

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found in workflowSymbolTable: inputData"}}
🔍 REFS STDOUT: Content-Length: 155

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: symbol=\"inputData\", type=\"DataSymbol\""}}Content-Length: 157

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: parseTree context=\"DataDefinitionContext\""}}Content-Length: 175

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: contextName=\"DataDefinitionContext\", symbolName=\"inputData\""}}Content-Length: 147

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: position=2, symbolName=\"inputData\""}}Content-Length: 138

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: parseTree.getChildCount()=6"}}Content-Length: 180

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: child at 2: text=\"inputData\", isTerminalNode=true, textMatches=true"}}Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: Found matching terminal node"}}Content-Length: 154

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: identifierNode found, text=\"inputData\""}}Content-Length: 211

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: RangeUtils result={\"start\":{\"line\":1,\"character\":16},\"end\":{\"line\":1,\"character\":25}}"}}Content-Length: 308

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: Final result={\"uri\":\"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-data-definition-bxtkxB/workflow.xxp\",\"range\":{\"start\":{\"line\":1,\"character\":16},\"end\":{\"line\":1,\"character\":25}}}"}}Content-Length: 364

{"jsonrpc":"2.0","id":35,"result":[{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-data-definition-bxtkxB/workflow.xxp","range":{"start":{"line":5,"character":14},"end":{"line":5,"character":23}}},{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-data-definition-bxtkxB/workflow.xxp","range":{"start":{"line":1,"character":16},"end":{"line":1,"character":25}}}]}
References response: [
  {
    uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/xxp-data-definition-bxtkxB/workflow.xxp',
    range: { start: [Object], end: [Object] }
  },
  {
    uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/xxp-data-definition-bxtkxB/workflow.xxp',
    range: { start: [Object], end: [Object] }
  }
]
References result: [
  {
    "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/xxp-data-definition-bxtkxB/workflow.xxp",
    "range": {
      "start": {
        "line": 5,
        "character": 14
      },
      "end": {
        "line": 5,
        "character": 23
      }
    }
  },
  {
    "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/xxp-data-definition-bxtkxB/workflow.xxp",
    "range": {
      "start": {
        "line": 1,
        "character": 16
      },
      "end": {
        "line": 1,
        "character": 25
      }
    }
  }
]
Expected definition: workflow.xxp:2:17-26
Actual definition ranges:
  [0] 2:17-26 in file:////tmp/lsp-def-ref-tests-jdqhso/xxp-data-definition-bxtkxb/workflow.xxp
✅ Definition test passed at workflow.xxp:2:17-26
Expected 2 references, got 2
Expected references:
  [0] workflow.xxp:2:17-26
  [1] workflow.xxp:6:15-24
Actual reference ranges:
  [0] 6:15-24 in file:////tmp/lsp-def-ref-tests-jdqhso/xxp-data-definition-bxtkxb/workflow.xxp
  [1] 2:17-26 in file:////tmp/lsp-def-ref-tests-jdqhso/xxp-data-definition-bxtkxb/workflow.xxp
✅ Found expected reference at workflow.xxp:2:17-26
✅ Found expected reference at workflow.xxp:6:15-24
✅ References test passed
📊 Test xxp-data-definition completed (debug mode)
Cleaned up test directory: /tmp/lsp-def-ref-tests-JDqHso/xxp-data-definition-bxtkxB

=== Running definition/references test: xxp-data-usage ===
Test temp directory: /tmp/lsp-def-ref-tests-JDqHso/xxp-data-usage-rNwPqg
Created file: workflow.xxp at /tmp/lsp-def-ref-tests-JDqHso/xxp-data-usage-rNwPqg/workflow.xxp
Opening document: workflow.xxp -> file:////tmp/lsp-def-ref-tests-JDqHso/xxp-data-usage-rNwPqg/workflow.xxp
Document content (first 200 chars):
workflow DataWorkflow {
    define data inputData = "test.csv";
    define task processTask;
    
    configure task processTask {
        input inputData;
    }

    START -> processTask -> END;
}
Waiting for document processing...
Testing on: workflow.xxp at position {"line":5,"character":18}
Context around request position: " inputData;"
Line 5: "        input inputData;"
Character 18: "t"
File content with line numbers and character positions:
  0: "workflow DataWorkflow {"
     01234567890123456789012
  1: "    define data inputData = "test.csv";"
     012345678901234567890123456789012345678
  2: "    define task processTask;"
     0123456789012345678901234567
  3: "    "
  4: "    configure task processTask {"
  5: "        input inputData;"
  6: "    }"
  7: ""
  8: "    START -> processTask -> END;"
  9: "}"
Requesting definition for file:////tmp/lsp-def-ref-tests-JDqHso/xxp-data-usage-rNwPqg/workflow.xxp at {"line":5,"character":18}
🔍 REFS STDOUT: Content-Length: 211

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":4,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/xxp-data-usage-rNwPqg/workflow.xxp at {\"line\":5,\"character\":18}"}}
🔍 REFS STDOUT: Content-Length: 211

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/xxp-data-usage-rNwPqg/workflow.xxp at {\"line\":5,\"character\":18}"}}Content-Length: 152

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] TokenPosition: text=\"inputData\", context=\"DataNameReadContext\""}}Content-Length: 149

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"inputData\" in context \"DataNameReadContext\""}}Content-Length: 153

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=true"}}Content-Length: 143

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Using default resolution for context: DataNameReadContext"}}Content-Length: 130

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default: Trying document.workflowSymbolTable"}}Content-Length: 134

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default: Found in workflowSymbolTable: inputData"}}Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found symbol: name=\"inputData\", type=\"DataSymbol\""}}Content-Length: 155

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: symbol=\"inputData\", type=\"DataSymbol\""}}Content-Length: 157

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: parseTree context=\"DataDefinitionContext\""}}Content-Length: 175
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: contextName=\"DataDefinitionContext\", symbolName=\"inputData\""}}Content-Length: 147

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: position=2, symbolName=\"inputData\""}}Content-Length: 138

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: parseTree.getChildCount()=6"}}Content-Length: 180

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: child at 2: text=\"inputData\", isTerminalNode=true, textMatches=true"}}Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: Found matching terminal node"}}Content-Length: 154

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: identifierNode found, text=\"inputData\""}}Content-Length: 211

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: RangeUtils result={\"start\":{\"line\":1,\"character\":16},\"end\":{\"line\":1,\"character\":25}}"}}Content-Length: 303

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: Final result={\"uri\":\"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-data-usage-rNwPqg/workflow.xxp\",\"range\":{\"start\":{\"line\":1,\"character\":16},\"end\":{\"line\":1,\"character\":25}}}"}}
🔍 REFS STDOUT: Content-Length: 185

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Generated location: {\"start\":{\"line\":1,\"character\":16},\"end\":{\"line\":1,\"character\":25}}"}}Content-Length: 193

{"jsonrpc":"2.0","id":36,"result":{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-data-usage-rNwPqg/workflow.xxp","range":{"start":{"line":1,"character":16},"end":{"line":1,"character":25}}}}
Definition response: {
  uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/xxp-data-usage-rNwPqg/workflow.xxp',
  range: {
    start: { line: 1, character: 16 },
    end: { line: 1, character: 25 }
  }
}
Definition result: {
  "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/xxp-data-usage-rNwPqg/workflow.xxp",
  "range": {
    "start": {
      "line": 1,
      "character": 16
    },
    "end": {
      "line": 1,
      "character": 25
    }
  }
}
Requesting references for file:////tmp/lsp-def-ref-tests-JDqHso/xxp-data-usage-rNwPqg/workflow.xxp at {"line":5,"character":18}
🔍 REFS STDOUT: Content-Length: 149

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"inputData\" in context \"DataNameReadContext\""}}Content-Length: 153

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=true"}}Content-Length: 143

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Using default resolution for context: DataNameReadContext"}}Content-Length: 130

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default: Trying document.workflowSymbolTable"}}
🔍 REFS STDOUT: Content-Length: 134

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default: Found in workflowSymbolTable: inputData"}}Content-Length: 155

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: symbol=\"inputData\", type=\"DataSymbol\""}}Content-Length: 157

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: parseTree context=\"DataDefinitionContext\""}}Content-Length: 175

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: contextName=\"DataDefinitionContext\", symbolName=\"inputData\""}}Content-Length: 147

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: position=2, symbolName=\"inputData\""}}Content-Length: 138

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: parseTree.getChildCount()=6"}}Content-Length: 180

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: child at 2: text=\"inputData\", isTerminalNode=true, textMatches=true"}}Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: Found matching terminal node"}}Content-Length: 154

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: identifierNode found, text=\"inputData\""}}Content-Length: 211

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: RangeUtils result={\"start\":{\"line\":1,\"character\":16},\"end\":{\"line\":1,\"character\":25}}"}}Content-Length: 303

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: Final result={\"uri\":\"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-data-usage-rNwPqg/workflow.xxp\",\"range\":{\"start\":{\"line\":1,\"character\":16},\"end\":{\"line\":1,\"character\":25}}}"}}Content-Length: 354

{"jsonrpc":"2.0","id":37,"result":[{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-data-usage-rNwPqg/workflow.xxp","range":{"start":{"line":5,"character":14},"end":{"line":5,"character":23}}},{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-data-usage-rNwPqg/workflow.xxp","range":{"start":{"line":1,"character":16},"end":{"line":1,"character":25}}}]}
References response: [
  {
    uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/xxp-data-usage-rNwPqg/workflow.xxp',
    range: { start: [Object], end: [Object] }
  },
  {
    uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/xxp-data-usage-rNwPqg/workflow.xxp',
    range: { start: [Object], end: [Object] }
  }
]
References result: [
  {
    "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/xxp-data-usage-rNwPqg/workflow.xxp",
    "range": {
      "start": {
        "line": 5,
        "character": 14
      },
      "end": {
        "line": 5,
        "character": 23
      }
    }
  },
  {
    "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/xxp-data-usage-rNwPqg/workflow.xxp",
    "range": {
      "start": {
        "line": 1,
        "character": 16
      },
      "end": {
        "line": 1,
        "character": 25
      }
    }
  }
]
Expected definition: workflow.xxp:2:17-26
Actual definition ranges:
  [0] 2:17-26 in file:////tmp/lsp-def-ref-tests-jdqhso/xxp-data-usage-rnwpqg/workflow.xxp
✅ Definition test passed at workflow.xxp:2:17-26
Expected 2 references, got 2
Expected references:
  [0] workflow.xxp:2:17-26
  [1] workflow.xxp:6:15-24
Actual reference ranges:
  [0] 6:15-24 in file:////tmp/lsp-def-ref-tests-jdqhso/xxp-data-usage-rnwpqg/workflow.xxp
  [1] 2:17-26 in file:////tmp/lsp-def-ref-tests-jdqhso/xxp-data-usage-rnwpqg/workflow.xxp
✅ Found expected reference at workflow.xxp:2:17-26
✅ Found expected reference at workflow.xxp:6:15-24
✅ References test passed
📊 Test xxp-data-usage completed (debug mode)
Cleaned up test directory: /tmp/lsp-def-ref-tests-JDqHso/xxp-data-usage-rNwPqg

=== Running definition/references test: xxp-task-configuration ===
Test temp directory: /tmp/lsp-def-ref-tests-JDqHso/xxp-task-configuration-Gaj7Vi
Created file: workflow.xxp at /tmp/lsp-def-ref-tests-JDqHso/xxp-task-configuration-Gaj7Vi/workflow.xxp
Opening document: workflow.xxp -> file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-configuration-Gaj7Vi/workflow.xxp
Document content (first 200 chars):
workflow SimpleWorkflow {
    define task myTask;
    define task anotherTask;
    
    configure task myTask {}

    START -> myTask -> anotherTask -> END;
}
Waiting for document processing...
Testing on: workflow.xxp at position {"line":4,"character":22}
Context around request position: "k myTask {}"
Line 4: "    configure task myTask {}"
Character 22: "a"
File content with line numbers and character positions:
  0: "workflow SimpleWorkflow {"
     0123456789012345678901234
  1: "    define task myTask;"
     01234567890123456789012
  2: "    define task anotherTask;"
     0123456789012345678901234567
  3: "    "
  4: "    configure task myTask {}"
  5: ""
  6: "    START -> myTask -> anotherTask -> END;"
  7: "}"
Requesting definition for file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-configuration-Gaj7Vi/workflow.xxp at {"line":4,"character":22}
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":4,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-configuration-Gaj7Vi/workflow.xxp at {\"line\":4,\"character\":22}"}}Content-Length: 219

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-configuration-Gaj7Vi/workflow.xxp at {\"line\":4,\"character\":22}"}}
🔍 REFS STDOUT: Content-Length: 149

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] TokenPosition: text=\"myTask\", context=\"TaskNameReadContext\""}}Content-Length: 146

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"myTask\" in context \"TaskNameReadContext\""}}Content-Length: 153

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=true"}}Content-Length: 114

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling TaskNameReadContext"}}Content-Length: 136

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] TaskNameReadContext: No experimentSymbol available"}}Content-Length: 143

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Using default resolution for context: TaskNameReadContext"}}Content-Length: 130

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default: Trying document.workflowSymbolTable"}}Content-Length: 131

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default: Found in workflowSymbolTable: myTask"}}Content-Length: 136

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found symbol: name=\"myTask\", type=\"TaskSymbol\""}}Content-Length: 152
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: symbol=\"myTask\", type=\"TaskSymbol\""}}Content-Length: 157

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: parseTree context=\"TaskDefinitionContext\""}}Content-Length: 172

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: contextName=\"TaskDefinitionContext\", symbolName=\"myTask\""}}Content-Length: 144

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: position=2, symbolName=\"myTask\""}}Content-Length: 138

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: parseTree.getChildCount()=4"}}Content-Length: 177

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: child at 2: text=\"myTask\", isTerminalNode=true, textMatches=true"}}Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: Found matching terminal node"}}Content-Length: 151

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: identifierNode found, text=\"myTask\""}}Content-Length: 211

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: RangeUtils result={\"start\":{\"line\":1,\"character\":16},\"end\":{\"line\":1,\"character\":22}}"}}Content-Length: 311

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: Final result={\"uri\":\"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-configuration-Gaj7Vi/workflow.xxp\",\"range\":{\"start\":{\"line\":1,\"character\":16},\"end\":{\"line\":1,\"character\":22}}}"}}Content-Length: 185

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Generated location: {\"start\":{\"line\":1,\"character\":16},\"end\":{\"line\":1,\"character\":22}}"}}Content-Length: 201

{"jsonrpc":"2.0","id":38,"result":{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-configuration-Gaj7Vi/workflow.xxp","range":{"start":{"line":1,"character":16},"end":{"line":1,"character":22}}}}
Definition response: {
  uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-configuration-Gaj7Vi/workflow.xxp',
  range: {
    start: { line: 1, character: 16 },
    end: { line: 1, character: 22 }
  }
}
Definition result: {
  "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-configuration-Gaj7Vi/workflow.xxp",
  "range": {
    "start": {
      "line": 1,
      "character": 16
    },
    "end": {
      "line": 1,
      "character": 22
    }
  }
}
Requesting references for file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-configuration-Gaj7Vi/workflow.xxp at {"line":4,"character":22}
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"myTask\" in context \"TaskNameReadContext\""}}
🔍 REFS STDOUT: Content-Length: 153

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=true"}}Content-Length: 114

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling TaskNameReadContext"}}Content-Length: 136

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] TaskNameReadContext: No experimentSymbol available"}}Content-Length: 143

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Using default resolution for context: TaskNameReadContext"}}Content-Length: 130

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default: Trying document.workflowSymbolTable"}}Content-Length: 131

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default: Found in workflowSymbolTable: myTask"}}Content-Length: 152

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: symbol=\"myTask\", type=\"TaskSymbol\""}}Content-Length: 157

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: parseTree context=\"TaskDefinitionContext\""}}
🔍 REFS STDOUT: Content-Length: 172

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: contextName=\"TaskDefinitionContext\", symbolName=\"myTask\""}}Content-Length: 144

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: position=2, symbolName=\"myTask\""}}Content-Length: 138

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: parseTree.getChildCount()=4"}}Content-Length: 177

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: child at 2: text=\"myTask\", isTerminalNode=true, textMatches=true"}}Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: Found matching terminal node"}}
🔍 REFS STDOUT: Content-Length: 151

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: identifierNode found, text=\"myTask\""}}Content-Length: 211

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: RangeUtils result={\"start\":{\"line\":1,\"character\":16},\"end\":{\"line\":1,\"character\":22}}"}}Content-Length: 311

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: Final result={\"uri\":\"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-configuration-Gaj7Vi/workflow.xxp\",\"range\":{\"start\":{\"line\":1,\"character\":16},\"end\":{\"line\":1,\"character\":22}}}"}}Content-Length: 537

{"jsonrpc":"2.0","id":39,"result":[{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-configuration-Gaj7Vi/workflow.xxp","range":{"start":{"line":4,"character":19},"end":{"line":4,"character":25}}},{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-configuration-Gaj7Vi/workflow.xxp","range":{"start":{"line":6,"character":13},"end":{"line":6,"character":19}}},{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-configuration-Gaj7Vi/workflow.xxp","range":{"start":{"line":1,"character":16},"end":{"line":1,"character":22}}}]}
References response: [
  {
    uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-configuration-Gaj7Vi/workflow.xxp',
    range: { start: [Object], end: [Object] }
  },
  {
    uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-configuration-Gaj7Vi/workflow.xxp',
    range: { start: [Object], end: [Object] }
  },
  {
    uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-configuration-Gaj7Vi/workflow.xxp',
    range: { start: [Object], end: [Object] }
  }
]
References result: [
  {
    "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-configuration-Gaj7Vi/workflow.xxp",
    "range": {
      "start": {
        "line": 4,
        "character": 19
      },
      "end": {
        "line": 4,
        "character": 25
      }
    }
  },
  {
    "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-configuration-Gaj7Vi/workflow.xxp",
    "range": {
      "start": {
        "line": 6,
        "character": 13
      },
      "end": {
        "line": 6,
        "character": 19
      }
    }
  },
  {
    "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-configuration-Gaj7Vi/workflow.xxp",
    "range": {
      "start": {
        "line": 1,
        "character": 16
      },
      "end": {
        "line": 1,
        "character": 22
      }
    }
  }
]
Expected definition: workflow.xxp:2:17-23
Actual definition ranges:
  [0] 2:17-23 in file:////tmp/lsp-def-ref-tests-jdqhso/xxp-task-configuration-gaj7vi/workflow.xxp
✅ Definition test passed at workflow.xxp:2:17-23
Expected 3 references, got 3
Expected references:
  [0] workflow.xxp:2:17-23
  [1] workflow.xxp:5:20-26
  [2] workflow.xxp:7:14-20
Actual reference ranges:
  [0] 5:20-26 in file:////tmp/lsp-def-ref-tests-jdqhso/xxp-task-configuration-gaj7vi/workflow.xxp
  [1] 7:14-20 in file:////tmp/lsp-def-ref-tests-jdqhso/xxp-task-configuration-gaj7vi/workflow.xxp
  [2] 2:17-23 in file:////tmp/lsp-def-ref-tests-jdqhso/xxp-task-configuration-gaj7vi/workflow.xxp
✅ Found expected reference at workflow.xxp:2:17-23
✅ Found expected reference at workflow.xxp:5:20-26
✅ Found expected reference at workflow.xxp:7:14-20
✅ References test passed
📊 Test xxp-task-configuration completed (debug mode)
Cleaned up test directory: /tmp/lsp-def-ref-tests-JDqHso/xxp-task-configuration-Gaj7Vi

=== Running definition/references test: xxp-task-definition ===
Test temp directory: /tmp/lsp-def-ref-tests-JDqHso/xxp-task-definition-uxJd1O
Created file: workflow.xxp at /tmp/lsp-def-ref-tests-JDqHso/xxp-task-definition-uxJd1O/workflow.xxp
Opening document: workflow.xxp -> file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-definition-uxJd1O/workflow.xxp
Document content (first 200 chars):
workflow SimpleWorkflow {
    define task myTask;
    define task anotherTask;
    
    configure task myTask {}

    START -> myTask -> anotherTask -> END;
}
Waiting for document processing...
Testing on: workflow.xxp at position {"line":1,"character":19}
Context around request position: "k myTask;"
Line 1: "    define task myTask;"
Character 19: "a"
File content with line numbers and character positions:
  0: "workflow SimpleWorkflow {"
     0123456789012345678901234
  1: "    define task myTask;"
     01234567890123456789012
  2: "    define task anotherTask;"
     0123456789012345678901234567
  3: "    "
  4: "    configure task myTask {}"
  5: ""
  6: "    START -> myTask -> anotherTask -> END;"
  7: "}"
Requesting definition for file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-definition-uxJd1O/workflow.xxp at {"line":1,"character":19}
🔍 REFS STDOUT: Content-Length: 216

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":4,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-definition-uxJd1O/workflow.xxp at {\"line\":1,\"character\":19}"}}
🔍 REFS STDOUT: Content-Length: 216

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-definition-uxJd1O/workflow.xxp at {\"line\":1,\"character\":19}"}}Content-Length: 151

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] TokenPosition: text=\"myTask\", context=\"TaskDefinitionContext\""}}Content-Length: 148

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"myTask\" in context \"TaskDefinitionContext\""}}Content-Length: 153

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=true"}}Content-Length: 116

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling TaskDefinitionContext"}}Content-Length: 147
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Trying document.workflowSymbolTable for TaskDefinitionContext"}}Content-Length: 122

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found in workflowSymbolTable: myTask"}}Content-Length: 136

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found symbol: name=\"myTask\", type=\"TaskSymbol\""}}Content-Length: 152

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: symbol=\"myTask\", type=\"TaskSymbol\""}}Content-Length: 157

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: parseTree context=\"TaskDefinitionContext\""}}Content-Length: 172

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: contextName=\"TaskDefinitionContext\", symbolName=\"myTask\""}}Content-Length: 144

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: position=2, symbolName=\"myTask\""}}Content-Length: 138

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: parseTree.getChildCount()=4"}}Content-Length: 177

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: child at 2: text=\"myTask\", isTerminalNode=true, textMatches=true"}}
🔍 REFS STDOUT: Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: Found matching terminal node"}}Content-Length: 151

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: identifierNode found, text=\"myTask\""}}Content-Length: 211

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: RangeUtils result={\"start\":{\"line\":1,\"character\":16},\"end\":{\"line\":1,\"character\":22}}"}}Content-Length: 308

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: Final result={\"uri\":\"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-definition-uxJd1O/workflow.xxp\",\"range\":{\"start\":{\"line\":1,\"character\":16},\"end\":{\"line\":1,\"character\":22}}}"}}Content-Length: 185

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Generated location: {\"start\":{\"line\":1,\"character\":16},\"end\":{\"line\":1,\"character\":22}}"}}Content-Length: 198

{"jsonrpc":"2.0","id":40,"result":{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-definition-uxJd1O/workflow.xxp","range":{"start":{"line":1,"character":16},"end":{"line":1,"character":22}}}}
Definition response: {
  uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-definition-uxJd1O/workflow.xxp',
  range: {
    start: { line: 1, character: 16 },
    end: { line: 1, character: 22 }
  }
}
Definition result: {
  "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-definition-uxJd1O/workflow.xxp",
  "range": {
    "start": {
      "line": 1,
      "character": 16
    },
    "end": {
      "line": 1,
      "character": 22
    }
  }
}
Requesting references for file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-definition-uxJd1O/workflow.xxp at {"line":1,"character":19}
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"myTask\" in context \"TaskDefinitionContext\""}}Content-Length: 153

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=true"}}Content-Length: 116
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling TaskDefinitionContext"}}Content-Length: 147

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Trying document.workflowSymbolTable for TaskDefinitionContext"}}Content-Length: 122

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found in workflowSymbolTable: myTask"}}Content-Length: 152

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: symbol=\"myTask\", type=\"TaskSymbol\""}}Content-Length: 157

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: parseTree context=\"TaskDefinitionContext\""}}Content-Length: 172

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: contextName=\"TaskDefinitionContext\", symbolName=\"myTask\""}}Content-Length: 144

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: position=2, symbolName=\"myTask\""}}Content-Length: 138

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: parseTree.getChildCount()=4"}}Content-Length: 177

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: child at 2: text=\"myTask\", isTerminalNode=true, textMatches=true"}}Content-Length: 139
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: Found matching terminal node"}}Content-Length: 151

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: identifierNode found, text=\"myTask\""}}Content-Length: 211

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: RangeUtils result={\"start\":{\"line\":1,\"character\":16},\"end\":{\"line\":1,\"character\":22}}"}}Content-Length: 308

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: Final result={\"uri\":\"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-definition-uxJd1O/workflow.xxp\",\"range\":{\"start\":{\"line\":1,\"character\":16},\"end\":{\"line\":1,\"character\":22}}}"}}Content-Length: 528

{"jsonrpc":"2.0","id":41,"result":[{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-definition-uxJd1O/workflow.xxp","range":{"start":{"line":4,"character":19},"end":{"line":4,"character":25}}},{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-definition-uxJd1O/workflow.xxp","range":{"start":{"line":6,"character":13},"end":{"line":6,"character":19}}},{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-definition-uxJd1O/workflow.xxp","range":{"start":{"line":1,"character":16},"end":{"line":1,"character":22}}}]}
References response: [
  {
    uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-definition-uxJd1O/workflow.xxp',
    range: { start: [Object], end: [Object] }
  },
  {
    uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-definition-uxJd1O/workflow.xxp',
    range: { start: [Object], end: [Object] }
  },
  {
    uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-definition-uxJd1O/workflow.xxp',
    range: { start: [Object], end: [Object] }
  }
]
References result: [
  {
    "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-definition-uxJd1O/workflow.xxp",
    "range": {
      "start": {
        "line": 4,
        "character": 19
      },
      "end": {
        "line": 4,
        "character": 25
      }
    }
  },
  {
    "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-definition-uxJd1O/workflow.xxp",
    "range": {
      "start": {
        "line": 6,
        "character": 13
      },
      "end": {
        "line": 6,
        "character": 19
      }
    }
  },
  {
    "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-definition-uxJd1O/workflow.xxp",
    "range": {
      "start": {
        "line": 1,
        "character": 16
      },
      "end": {
        "line": 1,
        "character": 22
      }
    }
  }
]
Expected definition: workflow.xxp:2:17-23
Actual definition ranges:
  [0] 2:17-23 in file:////tmp/lsp-def-ref-tests-jdqhso/xxp-task-definition-uxjd1o/workflow.xxp
✅ Definition test passed at workflow.xxp:2:17-23
Expected 3 references, got 3
Expected references:
  [0] workflow.xxp:2:17-23
  [1] workflow.xxp:5:20-26
  [2] workflow.xxp:7:14-20
Actual reference ranges:
  [0] 5:20-26 in file:////tmp/lsp-def-ref-tests-jdqhso/xxp-task-definition-uxjd1o/workflow.xxp
  [1] 7:14-20 in file:////tmp/lsp-def-ref-tests-jdqhso/xxp-task-definition-uxjd1o/workflow.xxp
  [2] 2:17-23 in file:////tmp/lsp-def-ref-tests-jdqhso/xxp-task-definition-uxjd1o/workflow.xxp
✅ Found expected reference at workflow.xxp:2:17-23
✅ Found expected reference at workflow.xxp:5:20-26
✅ Found expected reference at workflow.xxp:7:14-20
✅ References test passed
📊 Test xxp-task-definition completed (debug mode)
Cleaned up test directory: /tmp/lsp-def-ref-tests-JDqHso/xxp-task-definition-uxJd1O

=== Running definition/references test: xxp-task-usage-chain ===
Test temp directory: /tmp/lsp-def-ref-tests-JDqHso/xxp-task-usage-chain-J4J4jA
Created file: workflow.xxp at /tmp/lsp-def-ref-tests-JDqHso/xxp-task-usage-chain-J4J4jA/workflow.xxp
Opening document: workflow.xxp -> file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-usage-chain-J4J4jA/workflow.xxp
Document content (first 200 chars):
workflow SimpleWorkflow {
    define task myTask;
    define task anotherTask;
    
    configure task myTask {}

    START -> myTask -> anotherTask -> END;
}
Waiting for document processing...
Testing on: workflow.xxp at position {"line":6,"character":16}
Context around request position: "> myTask -> ano"
Line 6: "    START -> myTask -> anotherTask -> END;"
Character 16: "a"
File content with line numbers and character positions:
  0: "workflow SimpleWorkflow {"
     0123456789012345678901234
  1: "    define task myTask;"
     01234567890123456789012
  2: "    define task anotherTask;"
     0123456789012345678901234567
  3: "    "
  4: "    configure task myTask {}"
  5: ""
  6: "    START -> myTask -> anotherTask -> END;"
  7: "}"
Requesting definition for file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-usage-chain-J4J4jA/workflow.xxp at {"line":6,"character":16}
🔍 REFS STDOUT: Content-Length: 217

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":4,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-usage-chain-J4J4jA/workflow.xxp at {\"line\":6,\"character\":16}"}}
🔍 REFS STDOUT: Content-Length: 217

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-usage-chain-J4J4jA/workflow.xxp at {\"line\":6,\"character\":16}"}}Content-Length: 149

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] TokenPosition: text=\"myTask\", context=\"TaskNameReadContext\""}}Content-Length: 146

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"myTask\" in context \"TaskNameReadContext\""}}Content-Length: 153

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=true"}}Content-Length: 114

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling TaskNameReadContext"}}Content-Length: 136

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] TaskNameReadContext: No experimentSymbol available"}}Content-Length: 143

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Using default resolution for context: TaskNameReadContext"}}
🔍 REFS STDOUT: Content-Length: 130

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default: Trying document.workflowSymbolTable"}}Content-Length: 131

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default: Found in workflowSymbolTable: myTask"}}Content-Length: 136

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found symbol: name=\"myTask\", type=\"TaskSymbol\""}}Content-Length: 152

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: symbol=\"myTask\", type=\"TaskSymbol\""}}Content-Length: 157

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: parseTree context=\"TaskDefinitionContext\""}}Content-Length: 172

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: contextName=\"TaskDefinitionContext\", symbolName=\"myTask\""}}Content-Length: 144

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: position=2, symbolName=\"myTask\""}}Content-Length: 138
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: parseTree.getChildCount()=4"}}Content-Length: 177

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: child at 2: text=\"myTask\", isTerminalNode=true, textMatches=true"}}Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: Found matching terminal node"}}Content-Length: 151

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: identifierNode found, text=\"myTask\""}}Content-Length: 211

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: RangeUtils result={\"start\":{\"line\":1,\"character\":16},\"end\":{\"line\":1,\"character\":22}}"}}Content-Length: 309

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: Final result={\"uri\":\"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-usage-chain-J4J4jA/workflow.xxp\",\"range\":{\"start\":{\"line\":1,\"character\":16},\"end\":{\"line\":1,\"character\":22}}}"}}Content-Length: 185

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Generated location: {\"start\":{\"line\":1,\"character\":16},\"end\":{\"line\":1,\"character\":22}}"}}Content-Length: 199

{"jsonrpc":"2.0","id":42,"result":{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-usage-chain-J4J4jA/workflow.xxp","range":{"start":{"line":1,"character":16},"end":{"line":1,"character":22}}}}
Definition response: {
  uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-usage-chain-J4J4jA/workflow.xxp',
  range: {
    start: { line: 1, character: 16 },
    end: { line: 1, character: 22 }
  }
}
Definition result: {
  "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-usage-chain-J4J4jA/workflow.xxp",
  "range": {
    "start": {
      "line": 1,
      "character": 16
    },
    "end": {
      "line": 1,
      "character": 22
    }
  }
}
Requesting references for file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-usage-chain-J4J4jA/workflow.xxp at {"line":6,"character":16}
🔍 REFS STDOUT: Content-Length: 146

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"myTask\" in context \"TaskNameReadContext\""}}Content-Length: 153

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=true"}}
🔍 REFS STDOUT: Content-Length: 114

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling TaskNameReadContext"}}Content-Length: 136

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] TaskNameReadContext: No experimentSymbol available"}}Content-Length: 143

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Using default resolution for context: TaskNameReadContext"}}Content-Length: 130

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default: Trying document.workflowSymbolTable"}}Content-Length: 131

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Default: Found in workflowSymbolTable: myTask"}}
🔍 REFS STDOUT: Content-Length: 152

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: symbol=\"myTask\", type=\"TaskSymbol\""}}Content-Length: 157

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: parseTree context=\"TaskDefinitionContext\""}}Content-Length: 172

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: contextName=\"TaskDefinitionContext\", symbolName=\"myTask\""}}Content-Length: 144

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: position=2, symbolName=\"myTask\""}}Content-Length: 138

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: parseTree.getChildCount()=4"}}Content-Length: 177

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: child at 2: text=\"myTask\", isTerminalNode=true, textMatches=true"}}Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: Found matching terminal node"}}Content-Length: 151

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: identifierNode found, text=\"myTask\""}}Content-Length: 211

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: RangeUtils result={\"start\":{\"line\":1,\"character\":16},\"end\":{\"line\":1,\"character\":22}}"}}Content-Length: 309

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: Final result={\"uri\":\"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-usage-chain-J4J4jA/workflow.xxp\",\"range\":{\"start\":{\"line\":1,\"character\":16},\"end\":{\"line\":1,\"character\":22}}}"}}Content-Length: 531

{"jsonrpc":"2.0","id":43,"result":[{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-usage-chain-J4J4jA/workflow.xxp","range":{"start":{"line":4,"character":19},"end":{"line":4,"character":25}}},{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-usage-chain-J4J4jA/workflow.xxp","range":{"start":{"line":6,"character":13},"end":{"line":6,"character":19}}},{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-usage-chain-J4J4jA/workflow.xxp","range":{"start":{"line":1,"character":16},"end":{"line":1,"character":22}}}]}
References response: [
  {
    uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-usage-chain-J4J4jA/workflow.xxp',
    range: { start: [Object], end: [Object] }
  },
  {
    uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-usage-chain-J4J4jA/workflow.xxp',
    range: { start: [Object], end: [Object] }
  },
  {
    uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-usage-chain-J4J4jA/workflow.xxp',
    range: { start: [Object], end: [Object] }
  }
]
References result: [
  {
    "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-usage-chain-J4J4jA/workflow.xxp",
    "range": {
      "start": {
        "line": 4,
        "character": 19
      },
      "end": {
        "line": 4,
        "character": 25
      }
    }
  },
  {
    "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-usage-chain-J4J4jA/workflow.xxp",
    "range": {
      "start": {
        "line": 6,
        "character": 13
      },
      "end": {
        "line": 6,
        "character": 19
      }
    }
  },
  {
    "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/xxp-task-usage-chain-J4J4jA/workflow.xxp",
    "range": {
      "start": {
        "line": 1,
        "character": 16
      },
      "end": {
        "line": 1,
        "character": 22
      }
    }
  }
]
Expected definition: workflow.xxp:2:17-23
Actual definition ranges:
  [0] 2:17-23 in file:////tmp/lsp-def-ref-tests-jdqhso/xxp-task-usage-chain-j4j4ja/workflow.xxp
✅ Definition test passed at workflow.xxp:2:17-23
Expected 3 references, got 3
Expected references:
  [0] workflow.xxp:2:17-23
  [1] workflow.xxp:5:20-26
  [2] workflow.xxp:7:14-20
Actual reference ranges:
  [0] 5:20-26 in file:////tmp/lsp-def-ref-tests-jdqhso/xxp-task-usage-chain-j4j4ja/workflow.xxp
  [1] 7:14-20 in file:////tmp/lsp-def-ref-tests-jdqhso/xxp-task-usage-chain-j4j4ja/workflow.xxp
  [2] 2:17-23 in file:////tmp/lsp-def-ref-tests-jdqhso/xxp-task-usage-chain-j4j4ja/workflow.xxp
✅ Found expected reference at workflow.xxp:2:17-23
✅ Found expected reference at workflow.xxp:5:20-26
✅ Found expected reference at workflow.xxp:7:14-20
✅ References test passed
📊 Test xxp-task-usage-chain completed (debug mode)
Cleaned up test directory: /tmp/lsp-def-ref-tests-JDqHso/xxp-task-usage-chain-J4J4jA

=== Running definition/references test: xxp-workflow-definition ===
Test temp directory: /tmp/lsp-def-ref-tests-JDqHso/xxp-workflow-definition-4EXBGO
Created file: workflow.xxp at /tmp/lsp-def-ref-tests-JDqHso/xxp-workflow-definition-4EXBGO/workflow.xxp
Opening document: workflow.xxp -> file:////tmp/lsp-def-ref-tests-JDqHso/xxp-workflow-definition-4EXBGO/workflow.xxp
Document content (first 200 chars):
workflow MyWorkflow {
    define task myTask;
    
    configure task myTask {}

    START -> myTask -> END;
}
Waiting for document processing...
Testing on: workflow.xxp at position {"line":0,"character":14}
Context around request position: "MyWorkflow {"
Line 0: "workflow MyWorkflow {"
Character 14: "k"
File content with line numbers and character positions:
  0: "workflow MyWorkflow {"
     012345678901234567890
  1: "    define task myTask;"
     01234567890123456789012
  2: "    "
     0123
  3: "    configure task myTask {}"
  4: ""
  5: "    START -> myTask -> END;"
  6: "}"
Requesting definition for file:////tmp/lsp-def-ref-tests-JDqHso/xxp-workflow-definition-4EXBGO/workflow.xxp at {"line":0,"character":14}
🔍 REFS STDOUT: Content-Length: 220

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":4,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/xxp-workflow-definition-4EXBGO/workflow.xxp at {\"line\":0,\"character\":14}"}}
🔍 REFS STDOUT: Content-Length: 220

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/xxp-workflow-definition-4EXBGO/workflow.xxp at {\"line\":0,\"character\":14}"}}Content-Length: 155

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] TokenPosition: text=\"MyWorkflow\", context=\"WorkflowHeaderContext\""}}Content-Length: 152

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"MyWorkflow\" in context \"WorkflowHeaderContext\""}}Content-Length: 153

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=true"}}Content-Length: 116

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling WorkflowHeaderContext"}}Content-Length: 113

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Trying document.symbolTable"}}Content-Length: 127

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found in document.symbolTable: MyWorkflow"}}Content-Length: 144

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found symbol: name=\"MyWorkflow\", type=\"WorkflowSymbol\""}}Content-Length: 160

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: symbol=\"MyWorkflow\", type=\"WorkflowSymbol\""}}Content-Length: 162

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: parseTree context=\"WorkflowDeclarationContext\""}}Content-Length: 181

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: contextName=\"WorkflowDeclarationContext\", symbolName=\"MyWorkflow\""}}
🔍 REFS STDOUT: Content-Length: 150

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: Using WorkflowDeclarationContext logic"}}Content-Length: 159

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] WorkflowDeclarationContext: Found WorkflowHeaderContext child, delegating"}}Content-Length: 148

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: position=1, symbolName=\"MyWorkflow\""}}Content-Length: 138

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: parseTree.getChildCount()=2"}}Content-Length: 181

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: child at 1: text=\"MyWorkflow\", isTerminalNode=true, textMatches=true"}}Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: Found matching terminal node"}}Content-Length: 155

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: identifierNode found, text=\"MyWorkflow\""}}Content-Length: 210

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: RangeUtils result={\"start\":{\"line\":0,\"character\":9},\"end\":{\"line\":0,\"character\":19}}"}}
🔍 REFS STDOUT: Content-Length: 311

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: Final result={\"uri\":\"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-workflow-definition-4EXBGO/workflow.xxp\",\"range\":{\"start\":{\"line\":0,\"character\":9},\"end\":{\"line\":0,\"character\":19}}}"}}Content-Length: 184

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Generated location: {\"start\":{\"line\":0,\"character\":9},\"end\":{\"line\":0,\"character\":19}}"}}Content-Length: 201

{"jsonrpc":"2.0","id":44,"result":{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-workflow-definition-4EXBGO/workflow.xxp","range":{"start":{"line":0,"character":9},"end":{"line":0,"character":19}}}}
Definition response: {
  uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/xxp-workflow-definition-4EXBGO/workflow.xxp',
  range: { start: { line: 0, character: 9 }, end: { line: 0, character: 19 } }
}
Definition result: {
  "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/xxp-workflow-definition-4EXBGO/workflow.xxp",
  "range": {
    "start": {
      "line": 0,
      "character": 9
    },
    "end": {
      "line": 0,
      "character": 19
    }
  }
}
Requesting references for file:////tmp/lsp-def-ref-tests-JDqHso/xxp-workflow-definition-4EXBGO/workflow.xxp at {"line":0,"character":14}
🔍 REFS STDOUT: Content-Length: 152

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"MyWorkflow\" in context \"WorkflowHeaderContext\""}}Content-Length: 153

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=true"}}Content-Length: 116

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling WorkflowHeaderContext"}}
🔍 REFS STDOUT: Content-Length: 113

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Trying document.symbolTable"}}Content-Length: 127

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found in document.symbolTable: MyWorkflow"}}Content-Length: 160

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: symbol=\"MyWorkflow\", type=\"WorkflowSymbol\""}}Content-Length: 162

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: parseTree context=\"WorkflowDeclarationContext\""}}Content-Length: 181

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: contextName=\"WorkflowDeclarationContext\", symbolName=\"MyWorkflow\""}}Content-Length: 150

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: Using WorkflowDeclarationContext logic"}}Content-Length: 159

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] WorkflowDeclarationContext: Found WorkflowHeaderContext child, delegating"}}Content-Length: 148

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: position=1, symbolName=\"MyWorkflow\""}}
🔍 REFS STDOUT: Content-Length: 138

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: parseTree.getChildCount()=2"}}Content-Length: 181

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: child at 1: text=\"MyWorkflow\", isTerminalNode=true, textMatches=true"}}Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: Found matching terminal node"}}Content-Length: 155

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: identifierNode found, text=\"MyWorkflow\""}}Content-Length: 210

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: RangeUtils result={\"start\":{\"line\":0,\"character\":9},\"end\":{\"line\":0,\"character\":19}}"}}Content-Length: 311

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: Final result={\"uri\":\"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-workflow-definition-4EXBGO/workflow.xxp\",\"range\":{\"start\":{\"line\":0,\"character\":9},\"end\":{\"line\":0,\"character\":19}}}"}}Content-Length: 203

{"jsonrpc":"2.0","id":45,"result":[{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-workflow-definition-4EXBGO/workflow.xxp","range":{"start":{"line":0,"character":9},"end":{"line":0,"character":19}}}]}
References response: [
  {
    uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/xxp-workflow-definition-4EXBGO/workflow.xxp',
    range: { start: [Object], end: [Object] }
  }
]
References result: [
  {
    "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/xxp-workflow-definition-4EXBGO/workflow.xxp",
    "range": {
      "start": {
        "line": 0,
        "character": 9
      },
      "end": {
        "line": 0,
        "character": 19
      }
    }
  }
]
Expected definition: workflow.xxp:1:10-20
Actual definition ranges:
  [0] 1:10-20 in file:////tmp/lsp-def-ref-tests-jdqhso/xxp-workflow-definition-4exbgo/workflow.xxp
✅ Definition test passed at workflow.xxp:1:10-20
Expected 1 references, got 1
Expected references:
  [0] workflow.xxp:1:10-20
Actual reference ranges:
  [0] 1:10-20 in file:////tmp/lsp-def-ref-tests-jdqhso/xxp-workflow-definition-4exbgo/workflow.xxp
✅ Found expected reference at workflow.xxp:1:10-20
✅ References test passed
📊 Test xxp-workflow-definition completed (debug mode)
Cleaned up test directory: /tmp/lsp-def-ref-tests-JDqHso/xxp-workflow-definition-4EXBGO

=== Running definition/references test: xxp-workflow-inheritance ===
Test temp directory: /tmp/lsp-def-ref-tests-JDqHso/xxp-workflow-inheritance-4hbPYe
Created file: BaseWorkflow.xxp at /tmp/lsp-def-ref-tests-JDqHso/xxp-workflow-inheritance-4hbPYe/BaseWorkflow.xxp
Created file: DerivedWorkflow.xxp at /tmp/lsp-def-ref-tests-JDqHso/xxp-workflow-inheritance-4hbPYe/DerivedWorkflow.xxp
Opening document: BaseWorkflow.xxp -> file:////tmp/lsp-def-ref-tests-JDqHso/xxp-workflow-inheritance-4hbPYe/BaseWorkflow.xxp
Document content (first 200 chars):
workflow BaseWorkflow {
    define task baseTask;
    
    configure task baseTask {}

    START -> baseTask -> END;
}
Opening document: DerivedWorkflow.xxp -> file:////tmp/lsp-def-ref-tests-JDqHso/xxp-workflow-inheritance-4hbPYe/DerivedWorkflow.xxp
Document content (first 200 chars):
workflow DerivedWorkflow from BaseWorkflow {
    define task derivedTask;
    
    configure task derivedTask {}

    START -> baseTask -> derivedTask -> END;
}
Waiting for document processing...
Testing on: DerivedWorkflow.xxp at position {"line":0,"character":36}
Context around request position: "aseWorkflow {"
Line 0: "workflow DerivedWorkflow from BaseWorkflow {"
Character 36: "r"
File content with line numbers and character positions:
  0: "workflow DerivedWorkflow from BaseWorkflow {"
     01234567890123456789012345678901234567890123
  1: "    define task derivedTask;"
     0123456789012345678901234567
  2: "    "
     0123
  3: "    configure task derivedTask {}"
  4: ""
  5: "    START -> baseTask -> derivedTask -> END;"
  6: "}"
Requesting definition for file:////tmp/lsp-def-ref-tests-JDqHso/xxp-workflow-inheritance-4hbPYe/DerivedWorkflow.xxp at {"line":0,"character":36}
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":4,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/xxp-workflow-inheritance-4hbPYe/DerivedWorkflow.xxp at {\"line\":0,\"character\":36}"}}Content-Length: 228

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Definition request: file:////tmp/lsp-def-ref-tests-JDqHso/xxp-workflow-inheritance-4hbPYe/DerivedWorkflow.xxp at {\"line\":0,\"character\":36}"}}Content-Length: 159

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] TokenPosition: text=\"BaseWorkflow\", context=\"WorkflowNameReadContext\""}}Content-Length: 156

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"BaseWorkflow\" in context \"WorkflowNameReadContext\""}}
🔍 REFS STDOUT: Content-Length: 153

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=true"}}Content-Length: 118

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling WorkflowNameReadContext"}}Content-Length: 138

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Trying folderSymbolTable for WorkflowNameReadContext"}}Content-Length: 126

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found in folderSymbolTable: BaseWorkflow"}}Content-Length: 146

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found symbol: name=\"BaseWorkflow\", type=\"WorkflowSymbol\""}}Content-Length: 162

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: symbol=\"BaseWorkflow\", type=\"WorkflowSymbol\""}}Content-Length: 162

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: parseTree context=\"WorkflowDeclarationContext\""}}Content-Length: 183

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: contextName=\"WorkflowDeclarationContext\", symbolName=\"BaseWorkflow\""}}Content-Length: 150

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: Using WorkflowDeclarationContext logic"}}Content-Length: 159

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] WorkflowDeclarationContext: Found WorkflowHeaderContext child, delegating"}}Content-Length: 150

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: position=1, symbolName=\"BaseWorkflow\""}}Content-Length: 138

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: parseTree.getChildCount()=2"}}
🔍 REFS STDOUT: Content-Length: 183

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: child at 1: text=\"BaseWorkflow\", isTerminalNode=true, textMatches=true"}}Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: Found matching terminal node"}}Content-Length: 157

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: identifierNode found, text=\"BaseWorkflow\""}}Content-Length: 210

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: RangeUtils result={\"start\":{\"line\":0,\"character\":9},\"end\":{\"line\":0,\"character\":21}}"}}Content-Length: 316

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: Final result={\"uri\":\"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-workflow-inheritance-4hbPYe/BaseWorkflow.xxp\",\"range\":{\"start\":{\"line\":0,\"character\":9},\"end\":{\"line\":0,\"character\":21}}}"}}Content-Length: 184

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Generated location: {\"start\":{\"line\":0,\"character\":9},\"end\":{\"line\":0,\"character\":21}}"}}Content-Length: 206

{"jsonrpc":"2.0","id":46,"result":{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-workflow-inheritance-4hbPYe/BaseWorkflow.xxp","range":{"start":{"line":0,"character":9},"end":{"line":0,"character":21}}}}
Definition response: {
  uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/xxp-workflow-inheritance-4hbPYe/BaseWorkflow.xxp',
  range: { start: { line: 0, character: 9 }, end: { line: 0, character: 21 } }
}
Definition result: {
  "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/xxp-workflow-inheritance-4hbPYe/BaseWorkflow.xxp",
  "range": {
    "start": {
      "line": 0,
      "character": 9
    },
    "end": {
      "line": 0,
      "character": 21
    }
  }
}
Requesting references for file:////tmp/lsp-def-ref-tests-JDqHso/xxp-workflow-inheritance-4hbPYe/DerivedWorkflow.xxp at {"line":0,"character":36}
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":3,"message":"[2025-06-25T12:45:05.955Z] [INFO] Received references request for document: file:////tmp/lsp-def-ref-tests-JDqHso/xxp-workflow-inheritance-4hbPYe/DerivedWorkflow.xxp"}}Content-Length: 156

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] resolveSymbol: \"BaseWorkflow\" in context \"WorkflowNameReadContext\""}}
🔍 REFS STDOUT: Content-Length: 153

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Available symbol tables: symbolTable=true, workflowSymbolTable=true"}}Content-Length: 118

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Handling WorkflowNameReadContext"}}Content-Length: 138

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Trying folderSymbolTable for WorkflowNameReadContext"}}Content-Length: 126

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] Found in folderSymbolTable: BaseWorkflow"}}Content-Length: 162

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: symbol=\"BaseWorkflow\", type=\"WorkflowSymbol\""}}Content-Length: 162

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: parseTree context=\"WorkflowDeclarationContext\""}}Content-Length: 183

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: contextName=\"WorkflowDeclarationContext\", symbolName=\"BaseWorkflow\""}}Content-Length: 150

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierFromContext: Using WorkflowDeclarationContext logic"}}Content-Length: 159

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] WorkflowDeclarationContext: Found WorkflowHeaderContext child, delegating"}}Content-Length: 150

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: position=1, symbolName=\"BaseWorkflow\""}}Content-Length: 138
🔍 REFS STDOUT: {"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: parseTree.getChildCount()=2"}}Content-Length: 183

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: child at 1: text=\"BaseWorkflow\", isTerminalNode=true, textMatches=true"}}Content-Length: 139

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getIdentifierAtPosition: Found matching terminal node"}}Content-Length: 157

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: identifierNode found, text=\"BaseWorkflow\""}}Content-Length: 210

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: RangeUtils result={\"start\":{\"line\":0,\"character\":9},\"end\":{\"line\":0,\"character\":21}}"}}Content-Length: 316

{"jsonrpc":"2.0","method":"window/logMessage","params":{"type":1,"message":"[REFS] getLocationFromDeclaration: Final result={\"uri\":\"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-workflow-inheritance-4hbPYe/BaseWorkflow.xxp\",\"range\":{\"start\":{\"line\":0,\"character\":9},\"end\":{\"line\":0,\"character\":21}}}"}}Content-Length: 384

{"jsonrpc":"2.0","id":47,"result":[{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-workflow-inheritance-4hbPYe/DerivedWorkflow.xxp","range":{"start":{"line":0,"character":30},"end":{"line":0,"character":42}}},{"uri":"file:////tmp/lsp-def-ref-tests-JDqHso/xxp-workflow-inheritance-4hbPYe/BaseWorkflow.xxp","range":{"start":{"line":0,"character":9},"end":{"line":0,"character":21}}}]}
References response: [
  {
    uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/xxp-workflow-inheritance-4hbPYe/DerivedWorkflow.xxp',
    range: { start: [Object], end: [Object] }
  },
  {
    uri: 'file:////tmp/lsp-def-ref-tests-JDqHso/xxp-workflow-inheritance-4hbPYe/BaseWorkflow.xxp',
    range: { start: [Object], end: [Object] }
  }
]
References result: [
  {
    "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/xxp-workflow-inheritance-4hbPYe/DerivedWorkflow.xxp",
    "range": {
      "start": {
        "line": 0,
        "character": 30
      },
      "end": {
        "line": 0,
        "character": 42
      }
    }
  },
  {
    "uri": "file:////tmp/lsp-def-ref-tests-JDqHso/xxp-workflow-inheritance-4hbPYe/BaseWorkflow.xxp",
    "range": {
      "start": {
        "line": 0,
        "character": 9
      },
      "end": {
        "line": 0,
        "character": 21
      }
    }
  }
]
Expected definition: BaseWorkflow.xxp:1:10-22
Actual definition ranges:
  [0] 1:10-22 in file:////tmp/lsp-def-ref-tests-jdqhso/xxp-workflow-inheritance-4hbpye/baseworkflow.xxp
✅ Definition test passed at BaseWorkflow.xxp:1:10-22
Expected 2 references, got 2
Expected references:
  [0] BaseWorkflow.xxp:1:10-22
  [1] DerivedWorkflow.xxp:10:32-44
Actual reference ranges:
  [0] 1:31-43 in file:////tmp/lsp-def-ref-tests-jdqhso/xxp-workflow-inheritance-4hbpye/derivedworkflow.xxp
  [1] 1:10-22 in file:////tmp/lsp-def-ref-tests-jdqhso/xxp-workflow-inheritance-4hbpye/baseworkflow.xxp
✅ Found expected reference at BaseWorkflow.xxp:1:10-22
❌ Missing expected reference at DerivedWorkflow.xxp:10:32-44
📊 Test xxp-workflow-inheritance failed: Error: References test failed - missing expected references at: DerivedWorkflow.xxp:10:32-44
Cleaned up test directory: /tmp/lsp-def-ref-tests-JDqHso/xxp-workflow-inheritance-4hbPYe
  console.log
    Shutting down language server...

      at SimpleLSPClient.stop (__tests__/ReferencesIntegration.test.ts:136:15)

  console.log
    Error during shutdown, force killing: Error: Shutdown timeout
        at Timeout._onTimeout (/root/xxp-tooling-v2/packages/language-server/__tests__/ReferencesIntegration.test.ts:142:62)
        at listOnTimeout (node:internal/timers:588:17)
        at processTimers (node:internal/timers:523:7)

      at SimpleLSPClient.stop (__tests__/ReferencesIntegration.test.ts:169:17)

FAIL @extremexp/language-server ./ReferencesIntegration.test.ts (29.8 s)
  Language Server Definition and References Tests (LSP)
    ✕ should provide definition and references for complex-multi-space (813 ms)
    ✕ should provide definition and references for comprehensive-full-features (902 ms)
    ✓ should provide definition and references for edge-case-no-definition (681 ms)
    ✓ should provide definition and references for edge-case-no-references (689 ms)
    ✕ should provide definition and references for espace-conditional-control (688 ms)
    ✕ should provide definition and references for espace-data-definition (688 ms)
    ✓ should provide definition and references for espace-experiment-definition (693 ms)
    ✕ should provide definition and references for espace-param-definition (675 ms)
    ✓ should provide definition and references for espace-space-definition (683 ms)
    ✓ should provide definition and references for espace-space-usage (683 ms)
    ✕ should provide definition and references for espace-task-from-workflow (1485 ms)
    ✕ should provide definition and references for espace-workflow-reference (802 ms)
    ✕ should provide definition and references for mixed-inheritance-with-experiment (893 ms)
    ✕ should provide definition and references for mixed-task-cross-reference (793 ms)
    ✕ should provide definition and references for mixed-workflow-experiment (789 ms)
    ✓ should provide definition and references for xxp-complex-task-chain (696 ms)
    ✓ should provide definition and references for xxp-data-definition (679 ms)
    ✓ should provide definition and references for xxp-data-usage (681 ms)
    ✓ should provide definition and references for xxp-task-configuration (678 ms)
    ✓ should provide definition and references for xxp-task-definition (685 ms)
    ✓ should provide definition and references for xxp-task-usage-chain (689 ms)
    ✓ should provide definition and references for xxp-workflow-definition (684 ms)
    ✕ should provide definition and references for xxp-workflow-inheritance (788 ms)

  ● Language Server Definition and References Tests (LSP) › should provide definition and references for complex-multi-space

    Definition test failed - no matching definition found. Expected: experiment.espace:19:11-17 (URI: file:////tmp/lsp-def-ref-tests-jdqhso/complex-multi-space-bnojzm/experiment.espace)

      522 |               console.error(`  [${i}] ${rangeToString(def.range)} in ${normalizeUri(def.uri)}`);
      523 |             });
    > 524 |             throw new Error(`Definition test failed - no matching definition found. Expected: ${locationWithFileToString(testCase.expectedDefinition)} (URI: ${normalizeUri(expectedFileUri)})`);
          |                   ^
      525 |           } else {
      526 |             console.log(`✅ Definition test passed at ${locationWithFileToString(testCase.expectedDefinition)}`);
      527 |           }

      at Object.<anonymous> (__tests__/ReferencesIntegration.test.ts:524:19)

  ● Language Server Definition and References Tests (LSP) › should provide definition and references for comprehensive-full-features

    Definition test failed - no matching definition found. Expected: ExtendedWorkflow.xxp:3:17-30 (URI: file:////tmp/lsp-def-ref-tests-jdqhso/comprehensive-full-features-qmtvm7/extendedworkflow.xxp)

      522 |               console.error(`  [${i}] ${rangeToString(def.range)} in ${normalizeUri(def.uri)}`);
      523 |             });
    > 524 |             throw new Error(`Definition test failed - no matching definition found. Expected: ${locationWithFileToString(testCase.expectedDefinition)} (URI: ${normalizeUri(expectedFileUri)})`);
          |                   ^
      525 |           } else {
      526 |             console.log(`✅ Definition test passed at ${locationWithFileToString(testCase.expectedDefinition)}`);
      527 |           }

      at Object.<anonymous> (__tests__/ReferencesIntegration.test.ts:524:19)

  ● Language Server Definition and References Tests (LSP) › should provide definition and references for espace-conditional-control

    References test failed - missing expected references at: experiment.espace:14:9-11

      584 |           if (missingReferences.length > 0) {
      585 |             const missingRefsStr = missingReferences.map(locationWithFileToString).join(', ');
    > 586 |             throw new Error(`References test failed - missing expected references at: ${missingRefsStr}`);
          |                   ^
      587 |           } else if (foundReferences !== testCase.expectedReferences.length) {
      588 |             throw new Error(`References test failed - expected ${testCase.expectedReferences.length} references, found ${foundReferences}`);
      589 |           } else {

      at Object.<anonymous> (__tests__/ReferencesIntegration.test.ts:586:19)

  ● Language Server Definition and References Tests (LSP) › should provide definition and references for espace-data-definition

    expect(received).not.toBeNull()

    Received: null

      490 |           console.log(`✅ Definition test passed (no definition expected)`);
      491 |         } else {
    > 492 |           expect(definitionResult).not.toBeNull();
          |                                        ^
      493 |           
      494 |           console.log(`Expected definition: ${locationWithFileToString(testCase.expectedDefinition)}`);
      495 |           

      at Object.<anonymous> (__tests__/ReferencesIntegration.test.ts:492:40)

  ● Language Server Definition and References Tests (LSP) › should provide definition and references for espace-param-definition

    expect(received).not.toBeNull()

    Received: null

      490 |           console.log(`✅ Definition test passed (no definition expected)`);
      491 |         } else {
    > 492 |           expect(definitionResult).not.toBeNull();
          |                                        ^
      493 |           
      494 |           console.log(`Expected definition: ${locationWithFileToString(testCase.expectedDefinition)}`);
      495 |           

      at Object.<anonymous> (__tests__/ReferencesIntegration.test.ts:492:40)

  ● Language Server Definition and References Tests (LSP) › should provide definition and references for espace-task-from-workflow

    expect(received).not.toBeNull()

    Received: null

      490 |           console.log(`✅ Definition test passed (no definition expected)`);
      491 |         } else {
    > 492 |           expect(definitionResult).not.toBeNull();
          |                                        ^
      493 |           
      494 |           console.log(`Expected definition: ${locationWithFileToString(testCase.expectedDefinition)}`);
      495 |           

      at Object.<anonymous> (__tests__/ReferencesIntegration.test.ts:492:40)

  ● Language Server Definition and References Tests (LSP) › should provide definition and references for espace-workflow-reference

    References test failed - missing expected references at: experiment.espace:11:19-33

      584 |           if (missingReferences.length > 0) {
      585 |             const missingRefsStr = missingReferences.map(locationWithFileToString).join(', ');
    > 586 |             throw new Error(`References test failed - missing expected references at: ${missingRefsStr}`);
          |                   ^
      587 |           } else if (foundReferences !== testCase.expectedReferences.length) {
      588 |             throw new Error(`References test failed - expected ${testCase.expectedReferences.length} references, found ${foundReferences}`);
      589 |           } else {

      at Object.<anonymous> (__tests__/ReferencesIntegration.test.ts:586:19)

  ● Language Server Definition and References Tests (LSP) › should provide definition and references for mixed-inheritance-with-experiment

    References test failed - missing expected references at: AdvancedML.xxp:12:27-33

      584 |           if (missingReferences.length > 0) {
      585 |             const missingRefsStr = missingReferences.map(locationWithFileToString).join(', ');
    > 586 |             throw new Error(`References test failed - missing expected references at: ${missingRefsStr}`);
          |                   ^
      587 |           } else if (foundReferences !== testCase.expectedReferences.length) {
      588 |             throw new Error(`References test failed - expected ${testCase.expectedReferences.length} references, found ${foundReferences}`);
      589 |           } else {

      at Object.<anonymous> (__tests__/ReferencesIntegration.test.ts:586:19)

  ● Language Server Definition and References Tests (LSP) › should provide definition and references for mixed-task-cross-reference

    expect(received).not.toBeNull()

    Received: null

      490 |           console.log(`✅ Definition test passed (no definition expected)`);
      491 |         } else {
    > 492 |           expect(definitionResult).not.toBeNull();
          |                                        ^
      493 |           
      494 |           console.log(`Expected definition: ${locationWithFileToString(testCase.expectedDefinition)}`);
      495 |           

      at Object.<anonymous> (__tests__/ReferencesIntegration.test.ts:492:40)

  ● Language Server Definition and References Tests (LSP) › should provide definition and references for mixed-workflow-experiment

    References test failed - missing expected references at: MLExperiment.espace:18:18-32

      584 |           if (missingReferences.length > 0) {
      585 |             const missingRefsStr = missingReferences.map(locationWithFileToString).join(', ');
    > 586 |             throw new Error(`References test failed - missing expected references at: ${missingRefsStr}`);
          |                   ^
      587 |           } else if (foundReferences !== testCase.expectedReferences.length) {
      588 |             throw new Error(`References test failed - expected ${testCase.expectedReferences.length} references, found ${foundReferences}`);
      589 |           } else {

      at Object.<anonymous> (__tests__/ReferencesIntegration.test.ts:586:19)

  ● Language Server Definition and References Tests (LSP) › should provide definition and references for xxp-workflow-inheritance

    References test failed - missing expected references at: DerivedWorkflow.xxp:10:32-44

      584 |           if (missingReferences.length > 0) {
      585 |             const missingRefsStr = missingReferences.map(locationWithFileToString).join(', ');
    > 586 |             throw new Error(`References test failed - missing expected references at: ${missingRefsStr}`);
          |                   ^
      587 |           } else if (foundReferences !== testCase.expectedReferences.length) {
      588 |             throw new Error(`References test failed - expected ${testCase.expectedReferences.length} references, found ${foundReferences}`);
      589 |           } else {

      at Object.<anonymous> (__tests__/ReferencesIntegration.test.ts:586:19)

Test Suites: 1 failed, 1 total
Tests:       11 failed, 12 passed, 23 total
Snapshots:   0 total
Time:        30.845 s
Ran all test suites matching ReferencesIntegration.test.ts.
Waiting for the debugger to disconnect...
