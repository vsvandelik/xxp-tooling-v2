=== TEST NAME: Basic Workflow Test ===

=== DESCRIPTION: Tests basic workflow inheritance and space configuration ===

=== FILE: a.xxp ===
workflow A {
	define task task1;
	define task task2;
	define data inputData;
	define data task1Output1;
	define data task1Output2;
	define data outputData;

	START -> task1 -> task2 -> END;	configure task task1 {
		implementation "path/to/task1.py";
		param firstParam = 0.2;
		param secondParam;
		input inputData;
		output task1Output1, task1Output2;
	}

	configure task task2 {
		param secondParam;
		param thirdParam;
		input task1Output1, task1Output2;
		output outputData;
	}
}

=== FILE: a1.xxp ===
workflow A1 from A {
	configure task task2 {
		implementation "path/to/new_task2.py";
	}
}

=== FILE: a2.xxp ===
workflow A2 from A {
	configure task task2 {
		implementation "path/to/new_task3.py";
	}
}

=== FILE: sample.espace ===
experiment E1 {
  space One of A1 {
    strategy gridsearch;
    param secondParam = enum(1,2,3);
    param thirdParam = range(0.1, 0.5, 0.1);
    configure task task2 {
      param secondParam = 20;
    }
  }

  space Two of A1 {
    strategy randomsearch;
    param secondParam = enum(1);
    param thirdParam = enum(0.1);
  }

  space Three of A2 {
    strategy gridsearch;
    param secondParam = enum(20,30,50);
    param thirdParam = enum(20, 2000, 50);
  }

  control {
    START -> One;
    One -?> Two {
      condition "input() == 'yes'";
    }
    One -?> Three {
      condition "input() == 'no'";
    }
    Two -> END;
    Three -> END;
  }

  define data inputData = "path/to/input/file";
}

=== EXPECTED OUTPUT ===
{
  "experiment": "E1",
  "version": "1.0",
  "tasks": [
    [
      {
        "taskId": "A1:task1",
        "workflow": "A1",
        "implementation": "path/to/task1.py",
        "dynamicParameters": [
          "secondParam",
          "thirdParam"
        ],
        "staticParameters": {
          "firstParam": 0.2
        },
        "inputData": [
          "inputData"
        ],
        "outputData": [
          "task1Output1",
          "task1Output2"
        ]
      },
      {
        "taskId": "A1:task2",
        "workflow": "A1",
        "implementation": "path/to/new_task2.py",
        "dynamicParameters": [
          "thirdParam"
        ],
        "staticParameters": {
          "secondParam": 20
        },
        "inputData": [
          "task1Output1",
          "task1Output2"
        ],
        "outputData": [
          "outputData"
        ]
      }
    ],
    [
      {
        "taskId": "A2:task1",
        "workflow": "A2",
        "implementation": "path/to/task1.py",
        "dynamicParameters": [
          "secondParam",
          "thirdParam"
        ],
        "staticParameters": {
          "firstParam": 0.2
        },
        "inputData": [
          "inputData"
        ],
        "outputData": [
          "task1Output1",
          "task1Output2"
        ]
      },
      {
        "taskId": "A2:task2",
        "workflow": "A2",
        "implementation": "path/to/new_task3.py",
        "dynamicParameters": [
          "secondParam",
          "thirdParam"
        ],
        "staticParameters": {},
        "inputData": [
          "task1Output1",
          "task1Output2"
        ],
        "outputData": [
          "outputData"
        ]
      }
    ]
  ],
  "spaces": [
    {
      "spaceId": "One",
      "tasksOrder": [
        "A1:task1",
        "A1:task2"
      ],
      "parameters": [
        {
          "secondParam": 1,
          "thirdParam": 0.1,
          "task2:secondParam": 20
        },
        {
          "secondParam": 1,
          "thirdParam": 0.2,
          "task2:secondParam": 20
        },
        {
          "secondParam": 1,
          "thirdParam": 0.3,
          "task2:secondParam": 20
        },
        {
          "secondParam": 1,
          "thirdParam": 0.4,
          "task2:secondParam": 20
        },
        {
          "secondParam": 1,
          "thirdParam": 0.5,
          "task2:secondParam": 20
        },
        {
          "secondParam": 2,
          "thirdParam": 0.1,
          "task2:secondParam": 20
        },
        {
          "secondParam": 2,
          "thirdParam": 0.2,
          "task2:secondParam": 20
        },
        {
          "secondParam": 2,
          "thirdParam": 0.3,
          "task2:secondParam": 20
        },
        {
          "secondParam": 2,
          "thirdParam": 0.4,
          "task2:secondParam": 20
        },
        {
          "secondParam": 2,
          "thirdParam": 0.5,
          "task2:secondParam": 20
        },
        {
          "secondParam": 3,
          "thirdParam": 0.1,
          "task2:secondParam": 20
        },
        {
          "secondParam": 3,
          "thirdParam": 0.2,
          "task2:secondParam": 20
        },
        {
          "secondParam": 3,
          "thirdParam": 0.3,
          "task2:secondParam": 20
        },
        {
          "secondParam": 3,
          "thirdParam": 0.4,
          "task2:secondParam": 20
        },
        {
          "secondParam": 3,
          "thirdParam": 0.5,
          "task2:secondParam": 20
        }
      ]
    },
    {
      "spaceId": "Two",
      "tasksOrder": [
        "A1:task1",
        "A1:task2"
      ],
      "parameters": [
        {
          "secondParam": 1,
          "thirdParam": 0.1
        },
        {
          "secondParam": 1,
          "thirdParam": 0.1
        },
        {
          "secondParam": 1,
          "thirdParam": 0.1
        },
        {
          "secondParam": 1,
          "thirdParam": 0.1
        },
        {
          "secondParam": 1,
          "thirdParam": 0.1
        },
        {
          "secondParam": 1,
          "thirdParam": 0.1
        },
        {
          "secondParam": 1,
          "thirdParam": 0.1
        },
        {
          "secondParam": 1,
          "thirdParam": 0.1
        },
        {
          "secondParam": 1,
          "thirdParam": 0.1
        },
        {
          "secondParam": 1,
          "thirdParam": 0.1
        }
      ]
    },
    {
      "spaceId": "Three",
      "tasksOrder": [
        "A2:task1",
        "A2:task2"
      ],
      "parameters": [
        {
          "secondParam": 20,
          "thirdParam": 20
        },
        {
          "secondParam": 20,
          "thirdParam": 2000
        },
        {
          "secondParam": 20,
          "thirdParam": 50
        },
        {
          "secondParam": 30,
          "thirdParam": 20
        },
        {
          "secondParam": 30,
          "thirdParam": 2000
        },
        {
          "secondParam": 30,
          "thirdParam": 50
        },
        {
          "secondParam": 50,
          "thirdParam": 20
        },
        {
          "secondParam": 50,
          "thirdParam": 2000
        },
        {
          "secondParam": 50,
          "thirdParam": 50
        }
      ]
    }
  ],
  "control": {
    "START": "One",
    "transitions": [
      {
        "from": "One",
        "to": "Two",
        "condition": "input() == 'yes'"
      },
      {
        "from": "One",
        "to": "Three",
        "condition": "input() == 'no'"
      },
      {
        "from": "Two",
        "to": "END"
      },
      {
        "from": "Three",
        "to": "END"
      }
    ]
  }
}